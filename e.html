<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earn For Earn - Login & Referral</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Add SDK Script for Rewarded Ads -->
    <script src='//libtl.com/sdk.js' data-zone='10541383' data-sdk='show_10541383'></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        :root {
            --bg-primary: #000000;
            --bg-secondary: #111111;
            --bg-card: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --border: #333333;
            --shadow: rgba(0, 0, 0, 0.5);
            --purple: #8a2be2;
            --purple-dark: #6a0dad;
            --blue: #2b6de2;
            --blue-dark: #1a5ad9;
            --success: #4CAF50;
            --error: #f44336;
            --warning: #ff9800;
        }
        
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .app-container {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            background-color: var(--bg-primary);
            box-shadow: 0 0 20px var(--shadow);
        }
        
        /* Loading Screen with Progress Bar */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-primary);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .loading-screen.hidden {
            display: none;
        }
        
        .loading-logo {
            width: 100px;
            height: 100px;
            border-radius: 25px;
            background: linear-gradient(135deg, var(--purple), var(--purple-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            animation: pulse 2s infinite;
            border: 3px solid rgba(255, 255, 255, 0.1);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(138, 43, 226, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(138, 43, 226, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(138, 43, 226, 0); }
        }
        
        .loading-logo i {
            font-size: 3rem;
            color: white;
        }
        
        .loading-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--purple), var(--blue));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .loading-subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 40px;
            text-align: center;
        }
        
        .progress-container {
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        .progress-percent {
            font-weight: 600;
            color: var(--purple);
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: var(--bg-secondary);
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid var(--border);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--purple), var(--blue));
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .loading-steps {
            margin-top: 25px;
            width: 100%;
            max-width: 300px;
        }
        
        .loading-step {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0.5;
            transition: all 0.3s ease;
        }
        
        .loading-step.active {
            opacity: 1;
            color: var(--text-primary);
        }
        
        .loading-step.completed {
            opacity: 0.8;
            color: var(--purple);
        }
        
        .step-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .loading-version {
            position: absolute;
            bottom: 20px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        /* Loading Spinner for operations */
        .loading-spinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1001;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .loading-spinner.active {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--bg-secondary);
            border-top: 5px solid var(--purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            margin-top: 20px;
            color: var(--text-secondary);
        }
        
        /* Login/Signup Screens */
        .auth-screen {
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 100vh;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .auth-container {
            background-color: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px var(--shadow);
            border: 1px solid var(--border);
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .app-logo {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            background-color: #222222;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2rem;
            color: white;
            border: 2px solid #333333;
        }
        
        .auth-title {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: white;
        }
        
        .auth-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }
        
        .auth-form {
            margin-bottom: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .form-input {
            width: 100%;
            padding: 15px;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #444444;
        }
        
        .referral-input-container {
            position: relative;
        }
        
        .optional-badge {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background-color: var(--bg-primary);
            color: var(--text-secondary);
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 6px;
        }
        
        .auth-button {
            width: 100%;
            padding: 16px;
            background-color: #222222;
            border: 1px solid #333333;
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .auth-button:hover {
            background-color: #333333;
        }
        
        .auth-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .auth-switch {
            text-align: center;
            margin-top: 25px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .auth-link {
            color: white;
            text-decoration: none;
            font-weight: 600;
            margin-left: 5px;
            cursor: pointer;
        }
        
        .auth-link:hover {
            text-decoration: underline;
        }
        
        /* Main App Screens */
        .header {
            background-color: var(--bg-secondary);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }
        
        .app-title {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .user-profile {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: #222222;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            cursor: pointer;
            color: white;
            border: 1px solid #333333;
        }
        
        .main-content {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            padding-bottom: 80px; /* Space for bottom nav */
        }
        
        .content-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .content-section.active {
            display: block;
        }
        
        /* Home Section */
        .balance-card {
            background: linear-gradient(135deg, var(--purple), var(--purple-dark));
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 20px var(--shadow);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .balance-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .balance-amount {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: white;
        }
        
        .pepe-info {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            margin-top: 10px;
            text-align: center;
            font-size: 0.85rem;
            opacity: 0.9;
            color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .earn-button {
            background-color: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            transition: all 0.3s;
        }
        
        .earn-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background-color: var(--bg-card);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 1px solid var(--border);
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        /* Rules Section */
        .rules-section {
            background-color: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--border);
        }
        
        .rules-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }
        
        .rules-list {
            list-style: none;
        }
        
        .rule-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .rule-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .rule-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #222222;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
            color: #cccccc;
            border: 1px solid #333333;
        }
        
        .rule-text {
            flex: 1;
            font-size: 0.9rem;
            line-height: 1.5;
            color: #cccccc;
        }
        
        .rule-highlight {
            color: white;
            font-weight: 600;
        }
        
        .rule-pepe {
            color: white;
            font-weight: 600;
        }
        
        /* Information Section */
        .info-section {
            background-color: var(--bg-card);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid var(--border);
        }
        
        .info-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            text-align: center;
            color: white;
        }
        
        .info-card {
            background-color: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        
        .info-card-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }
        
        .info-card-content {
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-secondary);
        }
        
        .info-card-content p {
            margin-bottom: 10px;
        }
        
        .info-card-content p:last-child {
            margin-bottom: 0;
        }
        
        .support-options {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .support-button {
            flex: 1;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #333333;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background-color: #222222;
            color: white;
        }
        
        .support-button:hover {
            background-color: #333333;
        }
        
        /* Task Section */
        .tasks-container {
            margin-top: 10px;
        }
        
        .task-card {
            background-color: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .task-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
        }
        
        .task-reward {
            background-color: #222222;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            border: 1px solid #333333;
        }
        
        .task-reward.pepe {
            background-color: var(--purple);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .task-reward.blue {
            background-color: var(--blue);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .task-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .task-status {
            font-size: 0.85rem;
            padding: 8px 15px;
            border-radius: 8px;
            text-align: center;
            margin-top: 10px;
            border: 1px solid #333333;
        }
        
        .task-status.pending {
            background-color: #1a1a1a;
            color: #cccccc;
        }
        
        .task-status.completed {
            background-color: #1a1a1a;
            color: #cccccc;
        }
        
        .task-status.rejected {
            background-color: #1a1a1a;
            color: #cccccc;
        }
        
        .task-status.countdown {
            background-color: #1a1a1a;
            color: #cccccc;
        }
        
        .task-status.limited {
            background-color: #1a1a1a;
            color: #cccccc;
        }
        
        .task-button {
            width: 100%;
            padding: 14px;
            background-color: #222222;
            border: 1px solid #333333;
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .task-button.pepe {
            background-color: var(--purple);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .task-button.blue {
            background-color: var(--blue);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .task-button:hover:not(:disabled) {
            background-color: #333333;
        }
        
        .task-button.pepe:hover:not(:disabled) {
            background-color: var(--purple-dark);
        }
        
        .task-button.blue:hover:not(:disabled) {
            background-color: var(--blue-dark);
        }
        
        .task-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: var(--bg-secondary);
        }
        
        .task-progress {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 8px;
            text-align: center;
        }
        
        /* Task Timer Display */
        .task-timer-display {
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            color: var(--purple);
            margin: 10px 0;
            padding: 10px;
            background: rgba(138, 43, 226, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }
        
        /* Withdraw Section - Binance */
        .withdraw-method {
            background-color: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            text-align: center;
        }
        
        .method-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background-color: #222222;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.5rem;
            color: white;
            border: 1px solid #333333;
        }
        
        .method-title {
            font-size: 1.2rem;
            margin-bottom: 5px;
            color: white;
        }
        
        .method-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .requirements-list {
            background-color: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        
        .requirement-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .requirement-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .requirement-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
            border: 1px solid #333333;
        }
        
        .requirement-icon.pending {
            color: var(--text-secondary);
            background-color: #222222;
        }
        
        .requirement-icon.completed {
            background-color: #222222;
            color: white;
        }
        
        .requirement-details {
            flex: 1;
        }
        
        .requirement-title {
            font-size: 0.95rem;
            margin-bottom: 3px;
            color: white;
        }
        
        .requirement-status {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .requirement-status.completed {
            color: #cccccc;
        }
        
        /* Binance Details Form */
        .binance-form {
            background-color: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--border);
            display: none;
        }
        
        .binance-form.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .binance-warning {
            background-color: #1a1a1a;
            border: 1px solid #333333;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            color: #cccccc;
        }
        
        .binance-warning i {
            color: #cccccc;
            margin-bottom: 10px;
            font-size: 1.5rem;
        }
        
        .form-note {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 5px;
            margin-bottom: 15px;
        }
        
        .next-button {
            width: 100%;
            padding: 16px;
            background-color: #222222;
            border: 1px solid #333333;
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            display: none;
        }
        
        .next-button.active {
            display: block;
        }
        
        .next-button:hover {
            background-color: #333333;
        }
        
        .next-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Friends Section - Enhanced */
        .referral-card {
            background-color: #111111;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px var(--shadow);
            position: relative;
            overflow: hidden;
            border: 1px solid #333333;
        }
        
        .referral-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #333333;
        }
        
        .referral-title {
            font-size: 1.3rem;
            margin-bottom: 12px;
            font-weight: 600;
            color: white;
        }
        
        .referral-description {
            font-size: 0.95rem;
            opacity: 0.9;
            margin-bottom: 15px;
            line-height: 1.5;
            color: #cccccc;
        }
        
        .referral-bonus {
            font-size: 1.1rem;
            margin-bottom: 20px;
            background-color: #1a1a1a;
            padding: 12px 20px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 600;
            color: white;
            border: 1px solid #333333;
        }
        
        .referral-code-container {
            background-color: #1a1a1a;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
            border: 2px dashed #333333;
        }
        
        .referral-code-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        
        .referral-code {
            font-family: monospace;
            font-size: 1.4rem;
            letter-spacing: 3px;
            font-weight: bold;
            color: white;
            padding: 10px;
            background: #111111;
            border-radius: 8px;
            display: inline-block;
            min-width: 180px;
            border: 1px solid #333333;
        }
        
        .referral-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .referral-action-btn {
            flex: 1;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #333333;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background-color: #222222;
            color: white;
        }
        
        .referral-action-btn.copy {
            background-color: var(--purple);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .referral-action-btn.share {
            background-color: #222222;
            color: white;
        }
        
        .referral-action-btn:hover {
            background-color: #333333;
        }
        
        .referral-action-btn.copy:hover {
            background-color: var(--purple-dark);
        }
        
        .referral-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 25px;
        }
        
        .referral-stat {
            background-color: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border);
        }
        
        .referral-stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
            margin-bottom: 5px;
        }
        
        .referral-stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .friend-item {
            background-color: var(--bg-card);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }
        
        .friend-item:hover {
            background-color: #222222;
        }
        
        .friend-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .friend-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: #222222;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            color: white;
            border: 1px solid #333333;
        }
        
        .friend-details h4 {
            font-size: 1rem;
            margin-bottom: 5px;
            color: white;
        }
        
        .friend-date {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .friend-earned {
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .zero-friends {
            text-align: center;
            padding: 50px 20px;
            color: var(--text-secondary);
        }
        
        .zero-friends i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
            color: #cccccc;
        }
        
        .zero-friends h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: white;
        }
        
        .zero-friends p {
            margin-top: 15px;
            font-size: 0.95rem;
            line-height: 1.5;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
            color: #cccccc;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--bg-secondary);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            border-top: 1px solid var(--border);
            z-index: 100;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .nav-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            padding: 8px 5px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 60px;
            border-radius: 8px;
        }
        
        .nav-btn i {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .nav-btn.active {
            color: white;
            background-color: #222222;
        }
        
        .nav-badge {
            position: absolute;
            top: -5px;
            right: 0;
            background-color: #333333;
            color: white;
            font-size: 0.6rem;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .nav-btn-container {
            position: relative;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: var(--bg-card);
            border-radius: 16px;
            padding: 25px;
            width: 100%;
            max-width: 320px;
            animation: modalFadeIn 0.3s ease;
            border: 1px solid #333333;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: white;
        }
        
        .modal-message {
            margin-bottom: 20px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #333333;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background-color: #222222;
            color: white;
        }
        
        .modal-btn.primary {
            background-color: var(--purple);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .modal-btn.secondary {
            background-color: #1a1a1a;
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        
        .modal-btn.pepe {
            background-color: var(--purple);
            color: white;
        }
        
        /* Countdown Timer */
        .countdown-timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            text-align: center;
            margin: 10px 0;
        }
        
        .countdown-text {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        /* Change Password Modal */
        .change-password-modal .form-group {
            margin-bottom: 20px;
        }
        
        .change-password-modal .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .change-password-modal .form-input {
            width: 100%;
            padding: 15px;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        /* User Menu */
        .user-menu {
            position: absolute;
            top: 60px;
            right: 20px;
            background-color: var(--bg-card);
            border-radius: 12px;
            padding: 15px;
            min-width: 200px;
            border: 1px solid var(--border);
            box-shadow: 0 10px 30px var(--shadow);
            z-index: 150;
            display: none;
        }
        
        .user-menu.active {
            display: block;
        }
        
        .user-info {
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 10px;
        }
        
        .user-email {
            font-size: 0.9rem;
            color: var(--text-secondary);
            word-break: break-all;
        }
        
        .user-referral {
            font-size: 0.8rem;
            color: white;
            margin-top: 5px;
        }
        
        .menu-item {
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }
        
        .menu-item:hover {
            background-color: var(--bg-secondary);
        }
        
        /* Zero state styling */
        .zero-value {
            color: var(--text-secondary) !important;
        }
        
        /* Success Message */
        .success-message {
            background-color: #1a1a1a;
            border: 1px solid #333333;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
            display: none;
        }
        
        .success-message.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .success-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--purple);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.5rem;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Player Back Modal */
        .player-back-modal .modal-content {
            max-width: 350px;
        }
        
        .player-back-info {
            text-align: center;
            padding: 15px;
            background-color: #1a1a1a;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #333333;
        }
        
        .player-back-warning {
            color: #cccccc;
            font-size: 0.9rem;
            margin-top: 15px;
        }
        
        /* 12 Second Timer Warning Modal */
        .timer-modal .modal-content {
            max-width: 350px;
        }
        
        .timer-info {
            text-align: center;
            padding: 20px;
            background-color: #1a1a1a;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #333333;
        }
        
        .timer-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            margin: 20px 0;
        }
        
        .timer-text {
            color: #cccccc;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        /* Improved Task 4 Modal */
        .task4-instructions {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid var(--purple);
        }
        
        .instruction-step {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }
        
        .instruction-step i {
            margin-right: 10px;
            color: var(--purple);
            width: 24px;
        }
        
        .task4-warning {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 15px 0;
            text-align: center;
        }
        
        /* Task Timer Display */
        .task-timer-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1002;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .task-timer-container.active {
            display: flex;
        }
        
        .task-timer-box {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            border: 2px solid var(--purple);
            max-width: 300px;
            width: 90%;
        }
        
        .task-timer-count {
            font-size: 4rem;
            font-weight: bold;
            color: var(--purple);
            margin: 20px 0;
            text-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
        }
        
        .task-timer-message {
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .task-timer-progress {
            width: 100%;
            height: 10px;
            background: var(--bg-secondary);
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .task-timer-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--purple), var(--blue));
            width: 0%;
            transition: width 0.1s linear;
        }
        
        /* Responsive adjustments for mini app */
        @media (max-width: 400px) {
            .app-container {
                max-width: 100%;
            }
            
            .balance-amount {
                font-size: 1.8rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }
            
            .stat-card {
                padding: 12px 8px;
            }
            
            .stat-value {
                font-size: 1.2rem;
            }
            
            .auth-container {
                padding: 25px 20px;
            }
            
            .support-options {
                flex-direction: column;
            }
            
            .referral-actions {
                flex-direction: column;
            }
            
            .referral-stats {
                grid-template-columns: 1fr;
            }
            
            .task-timer-box {
                padding: 20px;
            }
            
            .task-timer-count {
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen with Progress Bar -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">
            <i class="fas fa-wallet"></i>
        </div>
        <h1 class="loading-title">Earn For Earn</h1>
        <p class="loading-subtitle">Loading your experience...</p>
        
        <div class="progress-container">
            <div class="progress-label">
                <span>Initializing</span>
                <span class="progress-percent" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
        
        <div class="loading-steps">
            <div class="loading-step" id="step1">
                <div class="step-icon"><i class="fas fa-cog"></i></div>
                <span>Initializing system...</span>
            </div>
            <div class="loading-step" id="step2">
                <div class="step-icon"><i class="fas fa-fire"></i></div>
                <span>Connecting to Firebase...</span>
            </div>
            <div class="loading-step" id="step3">
                <div class="step-icon"><i class="fas fa-user"></i></div>
                <span>Checking authentication...</span>
            </div>
            <div class="loading-step" id="step4">
                <div class="step-icon"><i class="fas fa-coins"></i></div>
                <span>Loading user data...</span>
            </div>
            <div class="loading-step" id="step5">
                <div class="step-icon"><i class="fas fa-check"></i></div>
                <span>Ready to earn!</span>
            </div>
        </div>
        
        <div class="loading-version">Version 2.0.1</div>
    </div>
    
    <!-- Loading Spinner for operations -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
        <div class="loading-text" id="loadingText">Processing...</div>
    </div>
    
    <!-- Task Timer Overlay -->
    <div class="task-timer-container" id="taskTimerOverlay">
        <div class="task-timer-box">
            <div class="modal-title">
                <i class="fas fa-clock"></i>
                Task Timer
            </div>
            <div class="task-timer-count" id="taskTimerCount">12</div>
            <div class="task-timer-message" id="taskTimerMessage">
                Stay on this page. Don't switch tabs!
            </div>
            <div class="task-timer-progress">
                <div class="task-timer-progress-fill" id="taskTimerProgressFill"></div>
            </div>
            <div class="timer-text">
                Return automatically in <span id="remainingSeconds">12</span> seconds
            </div>
        </div>
    </div>
    
    <div class="app-container">
        <!-- Login/Signup Screens -->
        <div id="login-screen" class="auth-screen" style="display: none;">
            <div class="auth-container">
                <div class="auth-header">
                    <div class="app-logo">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <h1 class="auth-title">Earn For Earn</h1>
                    <p class="auth-subtitle">Login to your account</p>
                </div>
                
                <form id="login-form" class="auth-form">
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" id="login-email" class="form-input" placeholder="your@email.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" id="login-password" class="form-input" placeholder="••••••••" required>
                    </div>
                    
                    <button type="submit" class="auth-button" id="login-button">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>
                
                <div class="auth-switch">
                    Don't have an account?
                    <a class="auth-link" id="go-to-signup">Sign Up</a>
                </div>
            </div>
        </div>
        
        <div id="signup-screen" class="auth-screen" style="display: none;">
            <div class="auth-container">
                <div class="auth-header">
                    <div class="app-logo">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <h1 class="auth-title">Create Account</h1>
                    <p class="auth-subtitle">Join and start earning</p>
                </div>
                
                <form id="signup-form" class="auth-form">
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" id="signup-email" class="form-input" placeholder="your@email.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" id="signup-password" class="form-input" placeholder="••••••••" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Confirm Password</label>
                        <input type="password" id="signup-confirm-password" class="form-input" placeholder="••••••••" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Referral Code (Optional)</label>
                        <div class="referral-input-container">
                            <input type="text" id="signup-referral" class="form-input" placeholder="Enter referral code">
                            <div class="optional-badge">Optional</div>
                        </div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px;">
                            Get 500 bonus if you use a referral code
                        </div>
                    </div>
                    
                    <button type="submit" class="auth-button" id="signup-button">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                </form>
                
                <div class="auth-switch">
                    Already have an account?
                    <a class="auth-link" id="go-to-login">Login</a>
                </div>
            </div>
        </div>
        
        <!-- Main App (Hidden until login) -->
        <div id="main-app" style="display: none;">
            <!-- Header -->
            <div class="header">
                <div class="app-title">Earn For Earn</div>
                <div class="user-profile" id="userProfile">
                    <span id="userInitial">U</span>
                </div>
            </div>
            
            <!-- User Menu (Only Change Password) -->
            <div class="user-menu" id="userMenu">
                <div class="user-info">
                    <div style="font-weight: 600;" id="menuUserEmail">user@email.com</div>
                    <div class="user-referral">Referral Code: <span id="menuReferralCode">XXXXXX</span></div>
                </div>
                <div class="menu-item" id="changePassword">
                    <i class="fas fa-key"></i>
                    <span>Change Password</span>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="main-content">
                <!-- Home Section -->
                <div id="home-section" class="content-section active">
                    <div class="balance-card">
                        <div class="balance-label">Your Balance</div>
                        <div class="balance-amount" id="balanceAmount">0</div>
                        <div class="pepe-info" id="pepeInfo">
                            <i class="fas fa-info-circle"></i> Start earning by completing tasks
                        </div>
                        <button class="earn-button" id="earnBtn">
                            <i class="fas fa-headset"></i> Get Support
                        </button>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="referralsCount">0</div>
                            <div class="stat-label">Referrals</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalEarned">0</div>
                            <div class="stat-label">Total Earned</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="referralBonus">0</div>
                            <div class="stat-label">Ref. Bonus</div>
                        </div>
                    </div>
                    
                    <!-- Rules Section -->
                    <div class="rules-section">
                        <div class="rules-title">
                            <i class="fas fa-gavel"></i>
                            <span>Important Rules</span>
                        </div>
                        <ul class="rules-list">
                            <li class="rule-item">
                                <div class="rule-icon">
                                    <i class="fas fa-ban"></i>
                                </div>
                                <div class="rule-text">
                                    <span class="rule-highlight">No Cheating</span> - Using any automated tools or unfair methods will result in permanent ban.
                                </div>
                            </li>
                            <li class="rule-item">
                                <div class="rule-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="rule-text">
                                    <span class="rule-highlight">Report Bad Ads</span> - If you see any 18+ or inappropriate ads, please report to us immediately.
                                </div>
                            </li>
                            <li class="rule-item">
                                <div class="rule-icon">
                                    <i class="fas fa-user-check"></i>
                                </div>
                                <div class="rule-text">
                                    <span class="rule-highlight">Age Requirement</span> - You must be at least 18 years old to use this app and withdraw.
                                </div>
                            </li>
                            <li class="rule-item">
                                <div class="rule-icon">
                                    <i class="fas fa-wallet"></i>
                                </div>
                                <div class="rule-text">
                                    <span class="rule-highlight">Payment Schedule</span> - Payments are processed between <span class="rule-pepe">3rd-9th of every month</span>.
                                </div>
                            </li>
                            <li class="rule-item">
                                <div class="rule-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="rule-text">
                                    <span class="rule-highlight">Monthly Withdrawals</span> - You can withdraw once per month during payment period.
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <!-- Task Section -->
                <div id="task-section" class="content-section">
                    <div class="section-title" style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                        <h2 style="font-size: 1.3rem; color: white;">Daily Tasks (4 Tasks Available)</h2>
                        <div id="taskLimitInfo" style="font-size: 0.9rem; color: white;">500 attempts left</div>
                    </div>
                    
                    <div class="tasks-container" id="tasksContainer">
                        <!-- Tasks will be added dynamically here -->
                    </div>
                    
                    <div class="task-card" style="text-align: center; padding: 25px;">
                        <i class="fas fa-sync-alt" style="font-size: 2rem; color: #cccccc; margin-bottom: 15px;"></i>
                        <h3 style="margin-bottom: 10px; color: white;">Daily Task Limit</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">
                            You can complete each task 125 times per day. Total 500 attempts per day. The limit resets every 24 hours.
                        </p>
                        <div id="resetTimer" style="font-size: 0.85rem; color: #cccccc; margin-top: 10px;">
                            Next reset in: <span id="resetTime">24:00:00</span>
                        </div>
                    </div>
                </div>
                
                <!-- Withdraw Section - Binance Only -->
                <div id="withdraw-section" class="content-section">
                    <div class="section-title" style="margin-bottom: 20px;">
                        <span style="color: white;">Withdraw to Binance</span>
                        <span style="color: #cccccc; font-size: 0.9rem;">Min: 1,000,000</span>
                    </div>
                    
                    <div class="balance-card" style="margin-bottom: 25px;">
                        <div class="balance-label">Available for withdrawal</div>
                        <div class="balance-amount" id="withdrawBalance">0</div>
                        <div class="pepe-info" style="background-color: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.9);">
                            <i class="fas fa-exchange-alt"></i> Withdraw to your Binance wallet
                        </div>
                    </div>
                    
                    <!-- Payment Schedule Information -->
                    <div class="info-card" style="margin-bottom: 20px;">
                        <div class="info-card-title" style="margin-bottom: 15px;">
                            <i class="fas fa-calendar-check"></i>
                            <span>Monthly Payment Schedule</span>
                        </div>
                        <div class="info-card-content">
                            <p><strong>📅 Payment Period:</strong> 3rd - 9th of every month</p>
                            <p><strong>⏰ Processing:</strong> Within 7 days during this period</p>
                            <p><strong>💰 Monthly Limit:</strong> One withdrawal per month</p>
                            <p><strong>✅ Current Status:</strong> <span id="withdrawCurrentStatus" style="color: var(--purple); font-weight: bold;">Checking...</span></p>
                            <p><strong>📆 Next Available:</strong> <span id="withdrawNextDate">Loading...</span></p>
                        </div>
                    </div>
                    
                    <!-- Binance Method Card -->
                    <div class="withdraw-method">
                        <div class="method-icon">
                            <i class="fab fa-bitcoin"></i>
                        </div>
                        <div class="method-title">Binance</div>
                        <div class="method-subtitle">Withdraw to your Binance wallet</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 10px;">
                            <i class="fas fa-lock"></i> Secure & Fast Transactions
                        </div>
                    </div>
                    
                    <!-- Requirements List -->
                    <div class="requirements-list">
                        <h4 style="margin-bottom: 15px; font-size: 1rem; color: white;">Withdrawal Requirements</h4>
                        
                        <div class="requirement-item" id="req1">
                            <div class="requirement-icon pending">
                                <i class="fas fa-coins"></i>
                            </div>
                            <div class="requirement-details">
                                <div class="requirement-title">Minimum Balance: 1,000,000</div>
                                <div class="requirement-status" id="req1Status">Not met</div>
                            </div>
                        </div>
                        
                        <div class="requirement-item" id="req2">
                            <div class="requirement-icon pending">
                                <i class="fas fa-user-friends"></i>
                            </div>
                            <div class="requirement-details">
                                <div class="requirement-title">Minimum 3 Referrals</div>
                                <div class="requirement-status" id="req2Status">Not met</div>
                            </div>
                        </div>
                        
                        <div class="requirement-item" id="req3">
                            <div class="requirement-icon pending">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="requirement-details">
                                <div class="requirement-title">Monthly Withdrawal Window (3rd-9th)</div>
                                <div class="requirement-status" id="req3Status">Checking...</div>
                            </div>
                        </div>
                        
                        <div class="requirement-item" id="req4">
                            <div class="requirement-icon pending">
                                <i class="fas fa-history"></i>
                            </div>
                            <div class="requirement-details">
                                <div class="requirement-title">No Withdrawal This Month</div>
                                <div class="requirement-status" id="req4Status">Checking...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Next Button (Shows when all requirements met) -->
                    <button class="next-button" id="nextButton" disabled>
                        <i class="fas fa-arrow-right"></i> Continue to Withdraw
                    </button>
                    
                    <!-- Binance Details Form -->
                    <div class="binance-form" id="binanceForm">
                        <div class="binance-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div style="font-size: 0.9rem; margin-top: 5px; color: #cccccc;">
                                Ensure your Binance details are correct. Withdrawals cannot be reversed.
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Binance Email or UID</label>
                            <input type="text" id="binanceEmail" class="form-input" placeholder="email@binance.com or UID" required>
                            <div class="form-note">Your registered Binance email or user ID</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Withdrawal Amount</label>
                            <input type="number" id="withdrawAmount" class="form-input" placeholder="1000000" min="1000000" step="1000" required>
                            <div class="form-note">Minimum: 1,000,000, Maximum: Your balance</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Binance Pay ID (Optional)</label>
                            <input type="text" id="binancePayId" class="form-input" placeholder="Binance Pay ID if available">
                            <div class="form-note">For faster processing</div>
                        </div>
                        
                        <button class="auth-button" id="submitWithdrawBtn" style="background-color: var(--purple); border: 1px solid rgba(255, 255, 255, 0.2);">
                            <i class="fas fa-paper-plane"></i> Submit Withdrawal Request
                        </button>
                    </div>
                    
                    <!-- Success Message -->
                    <div class="success-message" id="successMessage">
                        <div class="success-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="modal-title" style="color: white;">Withdrawal Submitted!</div>
                        <div class="modal-message" style="text-align: center; color: #cccccc;">
                            Your withdrawal request has been submitted successfully. Payment will be processed between 3rd-9th of next month.
                        </div>
                        <div style="margin-top: 15px; font-size: 0.85rem; color: var(--text-secondary);">
                            <i class="fas fa-info-circle"></i> You'll receive a confirmation email
                        </div>
                    </div>
                </div>
                
                <!-- Friends/Referral Section - Enhanced -->
                <div id="friends-section" class="content-section">
                    <div class="referral-card">
                        <div class="referral-title">Invite Friends & Earn</div>
                        <div class="referral-description">
                            Share your referral code with friends. When they sign up using your code, you both get bonuses!
                        </div>
                        <div class="referral-bonus">
                            <i class="fas fa-gift"></i> Bonus: 500 per referral
                        </div>
                        
                        <div class="referral-code-container">
                            <div class="referral-code-label">Your Referral Code</div>
                            <div class="referral-code" id="referralCode">LOADING...</div>
                        </div>
                        
                        <div class="referral-actions">
                            <button class="referral-action-btn copy" id="copyReferralBtn">
                                <i class="fas fa-copy"></i> Copy Code
                            </button>
                            <button class="referral-action-btn share" id="shareReferralBtn">
                                <i class="fas fa-share-alt"></i> Share Code
                            </button>
                        </div>
                        
                        <div class="referral-stats">
                            <div class="referral-stat">
                                <div class="referral-stat-value" id="totalReferralsCount">0</div>
                                <div class="referral-stat-label">Total Referrals</div>
                            </div>
                            <div class="referral-stat">
                                <div class="referral-stat-value" id="totalReferralEarnings">0</div>
                                <div class="referral-stat-label">Total Earned</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-title" style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="font-size: 1.1rem; color: white;">Your Referrals</h3>
                        <span style="color: white; font-size: 0.9rem;" id="totalReferrals">0 referrals</span>
                    </div>
                    
                    <div class="zero-friends" id="zeroReferrals">
                        <i class="fas fa-user-friends"></i>
                        <h3>No Referrals Yet</h3>
                        <p>Share your referral code with friends to start earning bonuses!</p>
                        <button class="referral-action-btn share" id="zeroShareReferralBtn" style="margin-top: 25px; max-width: 250px; margin-left: auto; margin-right: auto;">
                            <i class="fas fa-share-alt"></i> Share Referral Code
                        </button>
                    </div>
                    
                    <!-- Referrals list (will be shown when referrals are added) -->
                    <div id="referralsList" style="display: none;">
                        <!-- Referral items will be added here dynamically -->
                    </div>
                </div>
                
                <!-- Information Section -->
                <div id="info-section" class="content-section">
                    <div class="info-section">
                        <div class="info-title">
                            <i class="fas fa-info-circle"></i>
                            Important Information
                        </div>
                        
                        <div class="info-card">
                            <div class="info-card-title">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Monthly Payment System</span>
                            </div>
                            <div class="info-card-content">
                                <p><strong>Payment Period:</strong> 3rd - 9th of every month</p>
                                <p><strong>Processing Time:</strong> Within 7 days during payment period</p>
                                <p><strong>Minimum Withdrawal:</strong> 1,000,000</p>
                                <p><strong>Monthly Limit:</strong> One withdrawal per month</p>
                                <p><strong>Task Reward:</strong> 100 per ad</p>
                                <p><strong>Daily Task Limits:</strong> Each task 125 times/day, Total 500 attempts/day</p>
                                <p><strong>Withdrawal Method:</strong> Binance Only</p>
                                <p><strong>Next Payment Window:</strong> <span id="infoNextPayment">Loading...</span></p>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-card-title">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>Rules & Guidelines</span>
                            </div>
                            <div class="info-card-content">
                                <p>1. <strong>No Cheating:</strong> Using any automated tools, bots, or unfair methods will result in permanent ban of your account.</p>
                                <p>2. <strong>Age Requirement:</strong> You must be at least 18 years old to use this app and withdraw.</p>
                                <p>3. <strong>Fair Use:</strong> Complete tasks honestly. Don't use VPNs or fake information.</p>
                                <p>4. <strong>Task Limits:</strong> Each task can be completed 125 times per day. Total daily limit is 500 attempts across all 4 tasks.</p>
                                <p>5. <strong>One Account:</strong> Only one account per person is allowed.</p>
                                <p>6. <strong>Monthly Withdrawals:</strong> You can withdraw once per month during 3rd-9th payment period.</p>
                                <p>7. <strong>Payment Processing:</strong> All withdrawals are processed between 3rd-9th of each month.</p>
                                <p>8. <strong>Minimum Requirements:</strong> Need 1,000,000 balance and 3 referrals to withdraw.</p>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-card-title">
                                <i class="fas fa-comments"></i>
                                <span>Contact & Support</span>
                            </div>
                            <div class="info-card-content">
                                <p>We're here to help you 24/7. If you have any questions, issues, or need support, please contact us:</p>
                                <p><strong>Telegram Chat Support:</strong> @earnforearnsuportteam</p>
                                <p><strong>Email Support:</strong> earnforearnsuportteam@gmail.com</p>
                                <p><strong>Response Time:</strong> Usually within 24 hours</p>
                                <p><strong>For Technical Issues:</strong> Contact our support team with screenshots</p>
                                <p><strong>For Payment Issues:</strong> Contact with your withdrawal ID during payment period</p>
                                <p><strong>For Reporting Ads:</strong> Send screenshot of the ad with details</p>
                            </div>
                        </div>
                        
                        <div class="support-options">
                            <button class="support-button chat" id="infoChatBtn">
                                <i class="fab fa-telegram"></i> Telegram Chat
                            </button>
                            <button class="support-button email" id="infoEmailBtn">
                                <i class="fas fa-envelope"></i> Email Support
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Navigation -->
            <div class="bottom-nav">
                <div class="nav-btn-container">
                    <button class="nav-btn active" id="homeNavBtn" data-target="home-section">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </button>
                </div>
                
                <div class="nav-btn-container">
                    <button class="nav-btn" id="taskNavBtn" data-target="task-section">
                        <i class="fas fa-tasks"></i>
                        <span>Tasks</span>
                    </button>
                    <div class="nav-badge" id="taskBadge" style="display: none;">0</div>
                </div>
                
                <div class="nav-btn-container">
                    <button class="nav-btn" id="withdrawNavBtn" data-target="withdraw-section">
                        <i class="fas fa-wallet"></i>
                        <span>Cashout</span>
                    </button>
                </div>
                
                <div class="nav-btn-container">
                    <button class="nav-btn" id="friendsNavBtn" data-target="friends-section">
                        <i class="fas fa-user-friends"></i>
                        <span>Referrals</span>
                    </button>
                    <div class="nav-badge" id="referralBadge" style="display: none;">0</div>
                </div>
                
                <div class="nav-btn-container">
                    <button class="nav-btn" id="infoNavBtn" data-target="info-section">
                        <i class="fas fa-info-circle"></i>
                        <span>Information</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Modals -->
        <div class="modal" id="successModal">
            <div class="modal-content">
                <div class="modal-title">
                    <i class="fas fa-check-circle" style="color: #cccccc; margin-right: 10px;"></i>
                    Success!
                </div>
                <div class="modal-message" id="successModalMessage">
                    Operation completed successfully.
                </div>
                <div class="modal-actions">
                    <button class="modal-btn primary" id="successOkBtn">OK</button>
                </div>
            </div>
        </div>
        
        <div class="modal" id="errorModal">
            <div class="modal-content">
                <div class="modal-title">
                    <i class="fas fa-exclamation-circle" style="color: #cccccc; margin-right: 10px;"></i>
                    Error
                </div>
                <div class="modal-message" id="errorMessage">
                    An error occurred.
                </div>
                <div class="modal-actions">
                    <button class="modal-btn primary" id="errorOkBtn">OK</button>
                </div>
            </div>
        </div>
        
        <div class="modal" id="referralBonusModal">
            <div class="modal-content">
                <div class="modal-title">
                    <i class="fas fa-gift" style="color: #cccccc; margin-right: 10px;"></i>
                    Referral Bonus!
                </div>
                <div class="modal-message" id="referralBonusMessage">
                    You received 500 referral bonus!
                </div>
                <div class="modal-actions">
                    <button class="modal-btn primary" id="referralBonusOkBtn">Awesome!</button>
                </div>
            </div>
        </div>
        
        <div class="modal" id="chatModal">
            <div class="modal-content">
                <div class="modal-title">
                    <i class="fab fa-telegram" style="color: #cccccc; margin-right: 10px;"></i>
                    Telegram Support
                </div>
                <div class="modal-message" id="chatMessage">
                    Click below to start a chat with our support team on Telegram. We're here to help you 24/7!
                    <div style="margin-top: 15px; padding: 10px; background-color: #1a1a1a; border-radius: 8px;">
                        <strong>Telegram:</strong> @earnforearnsuportteam<br>
                        <strong>Email:</strong> earnforearnsuportteam@gmail.com
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="modal-btn primary" id="startChatBtn">
                        <i class="fab fa-telegram"></i> Open Telegram
                    </button>
                    <button class="modal-btn secondary" id="cancelChatBtn">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Improved Task 4 Timer Modal -->
        <div class="modal timer-modal" id="timerWarningModal">
            <div class="modal-content">
                <div class="modal-title">
                    <i class="fas fa-clock" style="color: #cccccc; margin-right: 10px;"></i>
                    Task Instructions
                </div>
                
                <div class="task4-instructions" id="task4Instructions">
                    <h4 style="margin-bottom: 10px; color: white;">How to complete this task:</h4>
                    <div class="instruction-step">
                        <i class="fas fa-mouse-pointer"></i>
                        <span>Click "Start Task" to open a new tab</span>
                    </div>
                    <div class="instruction-step">
                        <i class="fas fa-clock"></i>
                        <span>Stay on the opened page for <strong>12 seconds</strong></span>
                    </div>
                    <div class="instruction-step">
                        <i class="fas fa-check-circle"></i>
                        <span>You will automatically return and receive <strong>100</strong></span>
                    </div>
                </div>
                
                <div class="task4-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Important:</strong> Do not close or switch tabs during the 12 seconds!
                </div>
                
                <div class="timer-info">
                    <div class="timer-display" id="warningTimerDisplay">12</div>
                    <div class="timer-text">Seconds you need to stay on the task page</div>
                </div>
                
                <div class="modal-actions">
                    <button class="modal-btn primary" id="timerOkBtn">
                        <i class="fas fa-play"></i> Start Task
                    </button>
                    <button class="modal-btn secondary" id="timerCancelBtn">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Change Password Modal -->
        <div class="modal" id="changePasswordModal">
            <div class="modal-content change-password-modal">
                <div class="modal-title">
                    <i class="fas fa-key" style="color: #cccccc; margin-right: 10px;"></i>
                    Change Password
                </div>
                
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label class="form-label">Current Password</label>
                        <input type="password" id="currentPassword" class="form-input" placeholder="••••••••" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">New Password</label>
                        <input type="password" id="newPassword" class="form-input" placeholder="••••••••" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Confirm New Password</label>
                        <input type="password" id="confirmNewPassword" class="form-input" placeholder="••••••••" required>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="submit" class="modal-btn primary" id="changePasswordSubmitBtn">
                            <i class="fas fa-save"></i> Change Password
                        </button>
                        <button type="button" class="modal-btn secondary" id="cancelChangePasswordBtn">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCAlQL5txzjUagN9A5L0Idki9sjAezOczk",
            authDomain: "earn-for-earn.firebaseapp.com",
            databaseURL: "https://earn-for-earn-default-rtdb.firebaseio.com",
            projectId: "earn-for-earn",
            storageBucket: "earn-for-earn.firebasestorage.app",
            messagingSenderId: "730217056305",
            appId: "1:730217056305:web:d1ab3c775b1ed097742d10",
            measurementId: "G-N8PP006EGK"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Loading Progress Management
        class LoadingManager {
            constructor() {
                this.progress = 0;
                this.totalSteps = 5;
                this.currentStep = 0;
                this.loadingScreen = document.getElementById('loadingScreen');
                this.progressFill = document.getElementById('progressFill');
                this.progressPercent = document.getElementById('progressPercent');
                this.steps = [
                    document.getElementById('step1'),
                    document.getElementById('step2'),
                    document.getElementById('step3'),
                    document.getElementById('step4'),
                    document.getElementById('step5')
                ];
            }
            
            // Update progress bar
            updateProgress(percent) {
                this.progress = Math.min(Math.max(percent, 0), 100);
                this.progressFill.style.width = `${this.progress}%`;
                this.progressPercent.textContent = `${Math.round(this.progress)}%`;
            }
            
            // Animate progress from current to target
            animateProgress(targetPercent, duration = 500) {
                return new Promise((resolve) => {
                    const start = this.progress;
                    const end = targetPercent;
                    const startTime = performance.now();
                    
                    const animate = (currentTime) => {
                        const elapsed = currentTime - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        
                        // Easing function for smooth animation
                        const ease = (t) => t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
                        
                        this.updateProgress(start + (end - start) * ease(progress));
                        
                        if (progress < 1) {
                            requestAnimationFrame(animate);
                        } else {
                            this.updateProgress(end);
                            resolve();
                        }
                    };
                    
                    requestAnimationFrame(animate);
                });
            }
            
            // Complete a step
            completeStep(stepIndex) {
                if (stepIndex < this.totalSteps) {
                    this.currentStep = stepIndex + 1;
                    this.steps[stepIndex].classList.remove('active');
                    this.steps[stepIndex].classList.add('completed');
                    this.steps[stepIndex].querySelector('.step-icon').innerHTML = '<i class="fas fa-check"></i>';
                    
                    if (stepIndex + 1 < this.totalSteps) {
                        this.steps[stepIndex + 1].classList.add('active');
                    }
                    
                    // Calculate progress based on completed steps
                    const stepProgress = ((stepIndex + 1) / this.totalSteps) * 100;
                    return this.animateProgress(stepProgress, 300);
                }
                return Promise.resolve();
            }
            
            // Show loading screen
            show() {
                this.loadingScreen.classList.remove('hidden');
                this.reset();
            }
            
            // Hide loading screen
            hide() {
                // Complete final step and hide
                this.animateProgress(100, 300).then(() => {
                    setTimeout(() => {
                        this.loadingScreen.classList.add('hidden');
                    }, 500);
                });
            }
            
            // Reset loading screen
            reset() {
                this.progress = 0;
                this.currentStep = 0;
                this.updateProgress(0);
                
                // Reset all steps
                this.steps.forEach((step, index) => {
                    step.classList.remove('active', 'completed');
                    step.querySelector('.step-icon').innerHTML = index === 0 ? 
                        '<i class="fas fa-cog"></i>' : 
                        step.querySelector('.step-icon').innerHTML;
                });
                
                // Activate first step
                if (this.steps[0]) {
                    this.steps[0].classList.add('active');
                }
            }
        }

        // Initialize Loading Manager
        const loadingManager = new LoadingManager();

        // Firebase User Management System with Enhanced Monthly Payment Feature
        class FirebaseUserManager {
            constructor() {
                this.currentUser = null;
                this.userData = null;
                this.taskCompletions = {};
                this.dailyTaskCounts = {};
                this.lastResetDate = localStorage.getItem('earnPepeLastResetDate') || new Date().toDateString();
                this.taskTimers = {}; // Store active timers
                
                // Load existing data from localStorage
                this.loadLocalData();
                
                // Check if we need to reset daily counts
                this.checkAndResetDailyCounts();
            }
            
            // Load data from localStorage
            loadLocalData() {
                try {
                    const savedTaskCompletions = localStorage.getItem('earnPepeTaskCompletions');
                    if (savedTaskCompletions) {
                        this.taskCompletions = JSON.parse(savedTaskCompletions);
                    }
                    
                    const savedDailyCounts = localStorage.getItem('earnPepeDailyTaskCounts');
                    if (savedDailyCounts) {
                        this.dailyTaskCounts = JSON.parse(savedDailyCounts);
                    }
                } catch (error) {
                    console.error('Error loading local data:', error);
                    this.taskCompletions = {};
                    this.dailyTaskCounts = {};
                }
            }
            
            // Save data to localStorage
            saveLocalData() {
                try {
                    localStorage.setItem('earnPepeTaskCompletions', JSON.stringify(this.taskCompletions));
                    localStorage.setItem('earnPepeDailyTaskCounts', JSON.stringify(this.dailyTaskCounts));
                    localStorage.setItem('earnPepeLastResetDate', this.lastResetDate);
                } catch (error) {
                    console.error('Error saving local data:', error);
                }
            }
            
            // Check and reset daily task counts if needed
            checkAndResetDailyCounts() {
                const today = new Date().toDateString();
                
                if (today !== this.lastResetDate) {
                    console.log('Resetting daily task counts for new day');
                    // Reset daily counts
                    this.dailyTaskCounts = {};
                    this.lastResetDate = today;
                    this.saveLocalData();
                }
            }
            
            // Generate referral code from email
            generateReferralCode(email) {
                const base = email.split('@')[0].toUpperCase();
                const random = Math.random().toString(36).substr(2, 4).toUpperCase();
                return (base.length > 4 ? base.substring(0, 4) : base) + random;
            }
            
            // Check if current date is within payment window (3rd-9th)
            isWithinPaymentWindow() {
                const today = new Date();
                const dayOfMonth = today.getDate();
                return dayOfMonth >= 3 && dayOfMonth <= 9;
            }
            
            // Get next payment window dates
            getNextPaymentWindow() {
                const today = new Date();
                const currentMonth = today.getMonth();
                const currentYear = today.getFullYear();
                
                let nextMonth = currentMonth + 1;
                let nextYear = currentYear;
                
                if (nextMonth > 11) {
                    nextMonth = 0;
                    nextYear = currentYear + 1;
                }
                
                const startDate = new Date(nextYear, nextMonth, 3);
                const endDate = new Date(nextYear, nextMonth, 9);
                
                const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
                
                return {
                    start: startDate,
                    end: endDate,
                    formatted: `${startDate.getDate()} ${months[startDate.getMonth()]} - ${endDate.getDate()} ${months[endDate.getMonth()]} ${endDate.getFullYear()}`
                };
            }
            
            // Check if user has already withdrawn this month
            hasWithdrawnThisMonth(userData) {
                const withdrawalHistory = userData.withdrawalHistory || [];
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                
                return withdrawalHistory.some(withdrawal => {
                    if (!withdrawal.date) return false;
                    const withdrawalDate = new Date(withdrawal.date);
                    return withdrawalDate.getMonth() === currentMonth && 
                           withdrawalDate.getFullYear() === currentYear &&
                           withdrawal.status !== 'cancelled';
                });
            }
            
            // Get last withdrawal date
            getLastWithdrawalDate(userData) {
                const withdrawalHistory = userData.withdrawalHistory || [];
                if (withdrawalHistory.length === 0) return null;
                
                // Sort by date descending and find the last successful withdrawal
                const sortedWithdrawals = withdrawalHistory
                    .filter(w => w.status === 'completed' || w.status === 'pending')
                    .sort((a, b) => new Date(b.date) - new Date(a.date));
                
                return sortedWithdrawals.length > 0 ? new Date(sortedWithdrawals[0].date) : null;
            }
            
            // Get next available withdrawal date
            getNextWithdrawalDate(userData) {
                if (this.isWithinPaymentWindow() && !this.hasWithdrawnThisMonth(userData)) {
                    return "Available now (3rd-9th)";
                }
                
                const lastWithdrawal = this.getLastWithdrawalDate(userData);
                if (lastWithdrawal) {
                    const lastWithdrawalMonth = lastWithdrawal.getMonth();
                    const lastWithdrawalYear = lastWithdrawal.getFullYear();
                    const currentMonth = new Date().getMonth();
                    const currentYear = new Date().getFullYear();
                    
                    // If user withdrew this month, show next month's window
                    if (lastWithdrawalMonth === currentMonth && lastWithdrawalYear === currentYear) {
                        const nextWindow = this.getNextPaymentWindow();
                        return nextWindow.formatted;
                    }
                }
                
                // If not within window, show when window opens
                const today = new Date();
                const dayOfMonth = today.getDate();
                
                if (dayOfMonth < 3) {
                    // Before 3rd, show this month's window
                    const currentMonth = today.getMonth();
                    const currentYear = today.getFullYear();
                    const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                                   'July', 'August', 'September', 'October', 'November', 'December'];
                    return `3rd - 9th ${months[currentMonth]} ${currentYear}`;
                } else if (dayOfMonth > 9) {
                    // After 9th, show next month's window
                    const nextWindow = this.getNextPaymentWindow();
                    return nextWindow.formatted;
                }
                
                return "Calculating...";
            }
            
            // Get payment status text
            getPaymentStatus(userData) {
                const isWithinWindow = this.isWithinPaymentWindow();
                const hasWithdrawn = this.hasWithdrawnThisMonth(userData);
                
                if (isWithinWindow && !hasWithdrawn) {
                    return {
                        text: "Open for Withdrawals",
                        status: "open",
                        color: "var(--success)"
                    };
                } else if (hasWithdrawn) {
                    return {
                        text: "Already Withdrawn This Month",
                        status: "used",
                        color: "var(--text-secondary)"
                    };
                } else {
                    return {
                        text: "Closed - Wait for 3rd-9th",
                        status: "closed",
                        color: "var(--error)"
                    };
                }
            }
            
            // Create new user in Firebase
            async createUser(email, password, referralCode = null) {
                try {
                    // Create user in Firebase Auth
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    const user = userCredential.user;
                    
                    // Generate referral code
                    const userReferralCode = this.generateReferralCode(email);
                    
                    // Prepare initial user data
                    const userData = {
                        email: email.toLowerCase(),
                        referralCode: userReferralCode,
                        balance: 0,
                        totalEarned: 0,
                        referralBonus: 0,
                        referrals: [],
                        referredBy: referralCode || null,
                        createdAt: new Date().toISOString(),
                        fairUseVerified: false,
                        withdrawalHistory: [],
                        tasksCompleted: [],
                        lastActive: new Date().toISOString(),
                        lastWithdrawalMonth: null
                    };
                    
                    // Save user data to Realtime Database
                    await database.ref('users/' + user.uid).set(userData);
                    
                    // Check if referral code is valid and apply bonus
                    if (referralCode) {
                        await this.applyReferralBonus(user.uid, referralCode, email);
                    }
                    
                    return { 
                        success: true, 
                        user: user,
                        userData: userData,
                        hasReferralBonus: !!referralCode
                    };
                } catch (error) {
                    return { success: false, message: error.message };
                }
            }
            
            // Apply referral bonus
            async applyReferralBonus(userId, referralCode, userEmail) {
                try {
                    // Find user with this referral code
                    const usersRef = database.ref('users');
                    const snapshot = await usersRef.orderByChild('referralCode').equalTo(referralCode).once('value');
                    
                    if (snapshot.exists()) {
                        const referrerData = snapshot.val();
                        const referrerId = Object.keys(referrerData)[0];
                        const referrer = referrerData[referrerId];
                        
                        // Add 500 bonus to referrer
                        const referrerUpdates = {
                            referralBonus: referrer.referralBonus + 500,
                            balance: referrer.balance + 500,
                            totalEarned: referrer.totalEarned + 500
                        };
                        
                        // Add referral to referrer's list
                        const newReferral = {
                            email: userEmail.toLowerCase(),
                            date: new Date().toISOString(),
                            bonus: 500,
                            userId: userId
                        };
                        
                        // Get current referrals or create empty array
                        const referrals = referrer.referrals || [];
                        referrals.push(newReferral);
                        
                        // Update referrer's data
                        await database.ref('users/' + referrerId).update({
                            ...referrerUpdates,
                            referrals: referrals
                        });
                        
                        // Add 500 bonus to new user
                        await database.ref('users/' + userId).update({
                            balance: 500,
                            totalEarned: 500
                        });
                        
                        // Save referral bonus in database
                        await database.ref('referralBonuses/' + userId).set({
                            from: referrerId,
                            amount: 500,
                            date: new Date().toISOString()
                        });
                    }
                } catch (error) {
                    console.error('Error applying referral bonus:', error);
                }
            }
            
            // Login user with Firebase - with timeout
            async loginUser(email, password) {
                try {
                    // Add timeout to prevent hanging
                    const loginPromise = auth.signInWithEmailAndPassword(email, password);
                    const timeoutPromise = new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('Login timeout')), 15000)
                    );
                    
                    const userCredential = await Promise.race([loginPromise, timeoutPromise]);
                    const user = userCredential.user;
                    
                    // Get user data from database with timeout
                    const dataPromise = this.getUserData(user.uid);
                    const dataTimeoutPromise = new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('Data load timeout')), 10000)
                    );
                    
                    const userData = await Promise.race([dataPromise, dataTimeoutPromise]);
                    
                    if (!userData) {
                        // If no user data exists, create it
                        const userReferralCode = this.generateReferralCode(email);
                        const newUserData = {
                            email: email.toLowerCase(),
                            referralCode: userReferralCode,
                            balance: 0,
                            totalEarned: 0,
                            referralBonus: 0,
                            referrals: [],
                            referredBy: null,
                            createdAt: new Date().toISOString(),
                            fairUseVerified: false,
                            withdrawalHistory: [],
                            tasksCompleted: [],
                            lastActive: new Date().toISOString(),
                            lastWithdrawalMonth: null
                        };
                        
                        await database.ref('users/' + user.uid).set(newUserData);
                        this.userData = newUserData;
                    } else {
                        this.userData = userData;
                        
                        // Update last active time
                        await database.ref('users/' + user.uid).update({
                            lastActive: new Date().toISOString()
                        });
                    }
                    
                    this.currentUser = user;
                    
                    return { 
                        success: true, 
                        user: user,
                        userData: this.userData
                    };
                } catch (error) {
                    console.error('Login error:', error);
                    return { success: false, message: error.message || 'Login failed. Please check your connection.' };
                }
            }
            
            // Get user data from database
            async getUserData(userId) {
                try {
                    const snapshot = await database.ref('users/' + userId).once('value');
                    return snapshot.val();
                } catch (error) {
                    console.error('Error getting user data:', error);
                    return null;
                }
            }
            
            // Change user password
            async changePassword(userId, currentPassword, newPassword) {
                try {
                    const user = auth.currentUser;
                    
                    if (!user) {
                        return { success: false, message: 'No user logged in' };
                    }
                    
                    // Re-authenticate user before changing password
                    const credential = firebase.auth.EmailAuthProvider.credential(user.email, currentPassword);
                    await user.reauthenticateWithCredential(credential);
                    
                    // Update password
                    await user.updatePassword(newPassword);
                    
                    return { success: true, message: 'Password changed successfully' };
                } catch (error) {
                    return { success: false, message: error.message };
                }
            }
            
            // Update user data in Firebase
            async updateUser(userId, updates) {
                try {
                    await database.ref('users/' + userId).update(updates);
                    
                    // Update local user data
                    if (this.userData) {
                        this.userData = { ...this.userData, ...updates };
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Error updating user:', error);
                    return false;
                }
            }
            
            // Submit withdrawal request with monthly limit check
            async submitWithdrawal(userId, amount, binanceDetails) {
                try {
                    const userData = await this.getUserData(userId);
                    
                    if (!userData) {
                        return { success: false, message: 'User not found' };
                    }
                    
                    // Check if user has enough balance
                    if (userData.balance < amount) {
                        return { success: false, message: 'Insufficient balance' };
                    }
                    
                    // Check minimum amount (1,000,000)
                    if (amount < 1000000) {
                        return { success: false, message: 'Minimum withdrawal is 1,000,000' };
                    }
                    
                    // Check if within payment window (3rd-9th)
                    if (!this.isWithinPaymentWindow()) {
                        const nextWindow = this.getNextPaymentWindow();
                        return { 
                            success: false, 
                            message: `Withdrawals only available from 3rd-9th of each month. Next window: ${nextWindow.formatted}` 
                        };
                    }
                    
                    // Check if user has already withdrawn this month
                    if (this.hasWithdrawnThisMonth(userData)) {
                        const nextWindow = this.getNextPaymentWindow();
                        return { 
                            success: false, 
                            message: `You can only withdraw once per month. Next withdrawal: ${nextWindow.formatted}` 
                        };
                    }
                    
                    // Generate withdrawal ID
                    const withdrawalId = 'WD' + Date.now() + Math.random().toString(36).substr(2, 6).toUpperCase();
                    
                    const withdrawalRequest = {
                        id: withdrawalId,
                        userId: userId,
                        email: userData.email,
                        amount: amount,
                        method: 'Binance',
                        binanceDetails: binanceDetails,
                        status: 'pending',
                        submittedAt: new Date().toISOString(),
                        estimatedCompletion: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(), // 7 days from now
                        paymentMonth: new Date().getMonth(),
                        paymentYear: new Date().getFullYear()
                    };
                    
                    // Save withdrawal request
                    await database.ref('withdrawals/' + withdrawalId).set(withdrawalRequest);
                    
                    // Update user balance
                    await database.ref('users/' + userId).update({
                        balance: userData.balance - amount,
                        lastWithdrawalMonth: new Date().getMonth()
                    });
                    
                    // Add to user's withdrawal history
                    const withdrawalHistory = userData.withdrawalHistory || [];
                    withdrawalHistory.push({
                        id: withdrawalId,
                        amount: amount,
                        date: new Date().toISOString(),
                        status: 'pending',
                        month: new Date().getMonth(),
                        year: new Date().getFullYear(),
                        binanceDetails: binanceDetails
                    });
                    
                    await database.ref('users/' + userId).update({
                        withdrawalHistory: withdrawalHistory
                    });
                    
                    // Update local user data
                    this.userData.balance -= amount;
                    this.userData.lastWithdrawalMonth = new Date().getMonth();
                    if (!this.userData.withdrawalHistory) {
                        this.userData.withdrawalHistory = [];
                    }
                    this.userData.withdrawalHistory.push({
                        id: withdrawalId,
                        amount: amount,
                        date: new Date().toISOString(),
                        status: 'pending',
                        month: new Date().getMonth(),
                        year: new Date().getFullYear(),
                        binanceDetails: binanceDetails
                    });
                    
                    return { 
                        success: true, 
                        withdrawalId: withdrawalId,
                        message: 'Withdrawal request submitted successfully. Payment will be processed between 3rd-9th of next month.'
                    };
                } catch (error) {
                    console.error('Error submitting withdrawal:', error);
                    return { success: false, message: error.message };
                }
            }
            
            // Complete task and add reward - 100 per ad
            async completeTask(userId, taskId, reward) {
                try {
                    const userData = await this.getUserData(userId);
                    
                    if (!userData) return false;
                    
                    // Add reward to user balance
                    const updates = {
                        balance: userData.balance + reward,
                        totalEarned: userData.totalEarned + reward
                    };
                    
                    // Track task completion
                    const tasksCompleted = userData.tasksCompleted || [];
                    tasksCompleted.push({
                        taskId: taskId,
                        completedAt: new Date().toISOString(),
                        reward: reward
                    });
                    
                    updates.tasksCompleted = tasksCompleted;
                    
                    // Update user data
                    await database.ref('users/' + userId).update(updates);
                    
                    // Update local user data
                    this.userData = { ...this.userData, ...updates };
                    
                    // Update task completions tracking
                    if (!this.taskCompletions[userId]) {
                        this.taskCompletions[userId] = {};
                    }
                    
                    const now = new Date();
                    this.taskCompletions[userId][taskId] = {
                        lastCompleted: now.toISOString(),
                        count: (this.taskCompletions[userId][taskId]?.count || 0) + 1
                    };
                    
                    // Update daily task count for specific task
                    const today = now.toDateString();
                    if (!this.dailyTaskCounts[userId]) {
                        this.dailyTaskCounts[userId] = {};
                    }
                    
                    if (!this.dailyTaskCounts[userId][today]) {
                        this.dailyTaskCounts[userId][today] = {};
                    }
                    
                    if (!this.dailyTaskCounts[userId][today][taskId]) {
                        this.dailyTaskCounts[userId][today][taskId] = 0;
                    }
                    
                    this.dailyTaskCounts[userId][today][taskId] += 1;
                    
                    // Save to localStorage
                    this.saveLocalData();
                    
                    // Start cooldown timer
                    this.startCooldownTimer(userId, taskId);
                    
                    return true;
                } catch (error) {
                    console.error('Error completing task:', error);
                    return false;
                }
            }
            
            // Start cooldown timer for a task
            startCooldownTimer(userId, taskId) {
                const timerKey = `${userId}_${taskId}`;
                
                // Clear existing timer if any
                if (this.taskTimers[timerKey]) {
                    clearTimeout(this.taskTimers[timerKey]);
                }
                
                // Set new timer for 60 seconds (1 minute)
                this.taskTimers[timerKey] = setTimeout(() => {
                    // Timer completed, nothing to do here
                    // The UI will update on next check
                }, 60000); // 60 seconds
            }
            
            // Check if task can be completed (cooldown and daily limit)
            canCompleteTask(userId, taskId) {
                const today = new Date().toDateString();
                const taskDailyCount = this.dailyTaskCounts[userId]?.[today]?.[taskId] || 0;
                
                // Check individual task daily limit (125 per day)
                if (taskDailyCount >= 125) {
                    return { 
                        canComplete: false, 
                        timeRemaining: 0, 
                        reason: 'task_daily_limit',
                        taskDailyCount: taskDailyCount,
                        dailyTotalCount: this.getDailyTotalCount(userId, today)
                    };
                }
                
                // Check total daily limit (500 per day)
                const dailyTotalCount = this.getDailyTotalCount(userId, today);
                if (dailyTotalCount >= 500) {
                    return { 
                        canComplete: false, 
                        timeRemaining: 0, 
                        reason: 'total_daily_limit',
                        taskDailyCount: taskDailyCount,
                        dailyTotalCount: dailyTotalCount
                    };
                }
                
                if (!this.taskCompletions[userId] || !this.taskCompletions[userId][taskId]) {
                    return { 
                        canComplete: true, 
                        timeRemaining: 0,
                        taskDailyCount: taskDailyCount,
                        dailyTotalCount: dailyTotalCount
                    };
                }
                
                const lastCompletion = new Date(this.taskCompletions[userId][taskId].lastCompleted);
                const now = new Date();
                const timeDiff = now - lastCompletion;
                const cooldownTime = 60 * 1000; // 1 MINUTE (60 seconds) in milliseconds
                
                if (timeDiff >= cooldownTime) {
                    return { 
                        canComplete: true, 
                        timeRemaining: 0,
                        taskDailyCount: taskDailyCount,
                        dailyTotalCount: dailyTotalCount
                    };
                } else {
                    const remaining = Math.ceil((cooldownTime - timeDiff) / 1000);
                    return { 
                        canComplete: false, 
                        timeRemaining: remaining,
                        reason: 'cooldown',
                        taskDailyCount: taskDailyCount,
                        dailyTotalCount: dailyTotalCount
                    };
                }
            }
            
            // Get total daily count across all tasks
            getDailyTotalCount(userId, date) {
                const today = date || new Date().toDateString();
                const taskCounts = this.dailyTaskCounts[userId]?.[today] || {};
                
                let total = 0;
                for (const taskId in taskCounts) {
                    total += taskCounts[taskId];
                }
                
                return total;
            }
            
            // Get daily task count for specific task
            getTaskDailyCount(userId, taskId) {
                const today = new Date().toDateString();
                return this.dailyTaskCounts[userId]?.[today]?.[taskId] || 0;
            }
            
            // Get time until next daily reset
            getTimeUntilReset() {
                const now = new Date();
                const tomorrow = new Date(now);
                tomorrow.setDate(tomorrow.getDate() + 1);
                tomorrow.setHours(0, 0, 0, 0);
                
                return tomorrow.getTime() - now.getTime();
            }
            
            // Get user by referral code
            async getUserByReferralCode(code) {
                try {
                    const snapshot = await database.ref('users').orderByChild('referralCode').equalTo(code).once('value');
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        const userId = Object.keys(data)[0];
                        return { id: userId, ...data[userId] };
                    }
                    return null;
                } catch (error) {
                    console.error('Error getting user by referral code:', error);
                    return null;
                }
            }
        }

        // Initialize Firebase User Manager
        const userManager = new FirebaseUserManager();
        
        // Task Management System - 100 per ad!
        const tasks = [
            {
                id: 'task1',
                title: 'Watch Rewarded Ad & Earn',
                description: 'Watch the rewarded ad completely to earn 100! Daily limit: 125 times',
                reward: 100,
                type: 'rewardedAd',
                cooldown: 60, // 60 seconds (1 MINUTE)
                dailyLimit: 125,
                isPepe: true
            },
            {
                id: 'task2',
                title: 'In-App Interstitial Ad',
                description: 'Watch in-app interstitial ad to earn 100! Daily limit: 125 times, Max 2 ads every 6 minutes.',
                reward: 100,
                type: 'inAppInterstitial',
                cooldown: 60,
                dailyLimit: 125,
                isPepe: true
            },
            {
                id: 'task3',
                title: 'Watch Rewarded Popup Ad & Earn',
                description: 'Watch a rewarded popup ad for 12 seconds to earn 100! Daily limit: 125 times',
                reward: 100,
                type: 'rewardedPopupWithTimer',
                cooldown: 60,
                dailyLimit: 125,
                isPepe: true
            },
            {
                id: 'task4',
                title: 'Visit Website & Earn',
                description: 'Stay on the website for 12 seconds to earn 100! Daily limit: 125 times',
                reward: 100,
                link: 'https://www.effectivegatecpm.com/jcnnadrx80?key=6caea0a5c8cebb4a74b04609684f708f',
                cooldown: 60,
                dailyLimit: 125,
                isPepe: true
            }
        ];
        
        // DOM Elements
        const loadingSpinner = document.getElementById('loadingSpinner');
        const loadingText = document.getElementById('loadingText');
        const loginScreen = document.getElementById('login-screen');
        const signupScreen = document.getElementById('signup-screen');
        const mainApp = document.getElementById('main-app');
        const goToSignup = document.getElementById('go-to-signup');
        const goToLogin = document.getElementById('go-to-login');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const loginEmail = document.getElementById('login-email');
        const loginPassword = document.getElementById('login-password');
        const signupEmail = document.getElementById('signup-email');
        const signupPassword = document.getElementById('signup-password');
        const signupConfirmPassword = document.getElementById('signup-confirm-password');
        const signupReferral = document.getElementById('signup-referral');
        
        // App Elements
        const userProfile = document.getElementById('userProfile');
        const userMenu = document.getElementById('userMenu');
        const userInitial = document.getElementById('userInitial');
        const menuUserEmail = document.getElementById('menuUserEmail');
        const menuReferralCode = document.getElementById('menuReferralCode');
        const balanceAmount = document.getElementById('balanceAmount');
        const referralsCount = document.getElementById('referralsCount');
        const totalEarned = document.getElementById('totalEarned');
        const referralBonus = document.getElementById('referralBonus');
        const withdrawBalance = document.getElementById('withdrawBalance');
        const referralCode = document.getElementById('referralCode');
        const totalReferrals = document.getElementById('totalReferrals');
        const totalReferralsCount = document.getElementById('totalReferralsCount');
        const totalReferralEarnings = document.getElementById('totalReferralEarnings');
        const zeroReferrals = document.getElementById('zeroReferrals');
        const referralsList = document.getElementById('referralsList');
        const copyReferralBtn = document.getElementById('copyReferralBtn');
        const shareReferralBtn = document.getElementById('shareReferralBtn');
        const zeroShareReferralBtn = document.getElementById('zeroShareReferralBtn');
        const tasksContainer = document.getElementById('tasksContainer');
        const taskLimitInfo = document.getElementById('taskLimitInfo');
        const resetTime = document.getElementById('resetTime');
        const pepeInfo = document.getElementById('pepeInfo');
        
        // Payment Schedule Elements
        const withdrawCurrentStatus = document.getElementById('withdrawCurrentStatus');
        const withdrawNextDate = document.getElementById('withdrawNextDate');
        const infoNextPayment = document.getElementById('infoNextPayment');
        
        // Withdrawal Elements
        const nextButton = document.getElementById('nextButton');
        const binanceForm = document.getElementById('binanceForm');
        const binanceEmail = document.getElementById('binanceEmail');
        const withdrawAmount = document.getElementById('withdrawAmount');
        const binancePayId = document.getElementById('binancePayId');
        const submitWithdrawBtn = document.getElementById('submitWithdrawBtn');
        const successMessage = document.getElementById('successMessage');
        
        // Requirement Status Elements
        const req1Status = document.getElementById('req1Status');
        const req2Status = document.getElementById('req2Status');
        const req3Status = document.getElementById('req3Status');
        const req4Status = document.getElementById('req4Status');
        const req1Icon = document.querySelector('#req1 .requirement-icon');
        const req2Icon = document.querySelector('#req2 .requirement-icon');
        const req3Icon = document.querySelector('#req3 .requirement-icon');
        const req4Icon = document.querySelector('#req4 .requirement-icon');
        
        // Navigation Buttons
        const homeNavBtn = document.getElementById('homeNavBtn');
        const taskNavBtn = document.getElementById('taskNavBtn');
        const withdrawNavBtn = document.getElementById('withdrawNavBtn');
        const friendsNavBtn = document.getElementById('friendsNavBtn');
        const infoNavBtn = document.getElementById('infoNavBtn');
        
        // Content Sections
        const homeSection = document.getElementById('home-section');
        const taskSection = document.getElementById('task-section');
        const withdrawSection = document.getElementById('withdraw-section');
        const friendsSection = document.getElementById('friends-section');
        const infoSection = document.getElementById('info-section');
        
        // Task Timer Elements
        const taskTimerOverlay = document.getElementById('taskTimerOverlay');
        const taskTimerCount = document.getElementById('taskTimerCount');
        const taskTimerMessage = document.getElementById('taskTimerMessage');
        const taskTimerProgressFill = document.getElementById('taskTimerProgressFill');
        const remainingSeconds = document.getElementById('remainingSeconds');
        
        // Modals
        const successModal = document.getElementById('successModal');
        const errorModal = document.getElementById('errorModal');
        const referralBonusModal = document.getElementById('referralBonusModal');
        const chatModal = document.getElementById('chatModal');
        const timerWarningModal = document.getElementById('timerWarningModal');
        const changePasswordModal = document.getElementById('changePasswordModal');
        const successModalMessage = document.getElementById('successModalMessage');
        const errorMessage = document.getElementById('errorMessage');
        const referralBonusMessage = document.getElementById('referralBonusMessage');
        const warningTimerDisplay = document.getElementById('warningTimerDisplay');
        const successOkBtn = document.getElementById('successOkBtn');
        const errorOkBtn = document.getElementById('errorOkBtn');
        const referralBonusOkBtn = document.getElementById('referralBonusOkBtn');
        const timerOkBtn = document.getElementById('timerOkBtn');
        const timerCancelBtn = document.getElementById('timerCancelBtn');
        const startChatBtn = document.getElementById('startChatBtn');
        const cancelChatBtn = document.getElementById('cancelChatBtn');
        
        // Change Password Modal Elements
        const changePasswordBtn = document.getElementById('changePassword');
        const changePasswordForm = document.getElementById('changePasswordForm');
        const currentPassword = document.getElementById('currentPassword');
        const newPassword = document.getElementById('newPassword');
        const confirmNewPassword = document.getElementById('confirmNewPassword');
        const changePasswordSubmitBtn = document.getElementById('changePasswordSubmitBtn');
        const cancelChangePasswordBtn = document.getElementById('cancelChangePasswordBtn');
        
        // Information Section Buttons
        const infoChatBtn = document.getElementById('infoChatBtn');
        const infoEmailBtn = document.getElementById('infoEmailBtn');
        
        // Task timer variables
        let taskTab = null;
        let currentTask = null;
        let taskButtonElement = null;
        let taskTimerInterval = null;
        let taskSecondsRemaining = 12;
        let taskStartedTime = null;
        let taskCompleted = false;
        let taskTabCheckInterval = null;
        let isTaskTimerRunning = false;
        
        // Show loading spinner for operations
        function showLoading(message = 'Loading...') {
            loadingText.textContent = message;
            loadingSpinner.classList.add('active');
        }
        
        // Hide loading spinner
        function hideLoading() {
            loadingSpinner.classList.remove('active');
        }
        
        // Update payment schedule information
        function updatePaymentSchedule(userData) {
            if (!userData) return;
            
            const nextWindow = userManager.getNextPaymentWindow();
            const nextWithdrawal = userManager.getNextWithdrawalDate(userData);
            
            // Update withdraw page
            withdrawNextDate.textContent = nextWithdrawal;
            
            // Update info page
            infoNextPayment.textContent = nextWindow.formatted;
        }
        
        // Initialize app with loading progress
        async function initializeApp() {
            loadingManager.show();
            
            // Step 1: Initializing system (10%)
            await loadingManager.animateProgress(10);
            await loadingManager.completeStep(0);
            
            // Step 2: Connecting to Firebase (30%)
            await loadingManager.animateProgress(30);
            await loadingManager.completeStep(1);
            
            // Firebase connection with timeout and error handling
            try {
                // Step 3: Checking authentication (50%)
                await loadingManager.animateProgress(50);
                await loadingManager.completeStep(2);
                
                // Step 4: Loading user data (80%)
                await loadingManager.animateProgress(80);
                await loadingManager.completeStep(3);
                
                // Check Firebase auth state with timeout
                await new Promise((resolve, reject) => {
                    const authTimeout = setTimeout(() => {
                        console.log("Auth state change timeout - proceeding anyway");
                        resolve(null);
                    }, 10000); // 10 seconds timeout
                    
                    auth.onAuthStateChanged(async (user) => {
                        clearTimeout(authTimeout);
                        try {
                            if (user) {
                                // User is logged in, get their data
                                const userData = await userManager.getUserData(user.uid);
                                if (userData) {
                                    userManager.currentUser = user;
                                    userManager.userData = userData;
                                    
                                    // Final step: Ready (100%)
                                    await loadingManager.animateProgress(100);
                                    await loadingManager.completeStep(4);
                                    
                                    // Hide loading screen after delay
                                    setTimeout(() => {
                                        loadingManager.hide();
                                        setTimeout(() => {
                                            showMainApp(user, userData);
                                        }, 300);
                                    }, 800);
                                } else {
                                    // User doesn't have data yet, create it
                                    const userReferralCode = userManager.generateReferralCode(user.email);
                                    const newUserData = {
                                        email: user.email.toLowerCase(),
                                        referralCode: userReferralCode,
                                        balance: 0,
                                        totalEarned: 0,
                                        referralBonus: 0,
                                        referrals: [],
                                        referredBy: null,
                                        createdAt: new Date().toISOString(),
                                        fairUseVerified: false,
                                        withdrawalHistory: [],
                                        tasksCompleted: [],
                                        lastActive: new Date().toISOString(),
                                        lastWithdrawalMonth: null
                                    };
                                    
                                    await database.ref('users/' + user.uid).set(newUserData);
                                    userManager.userData = newUserData;
                                    
                                    // Final step: Ready (100%)
                                    await loadingManager.animateProgress(100);
                                    await loadingManager.completeStep(4);
                                    
                                    // Hide loading screen after delay
                                    setTimeout(() => {
                                        loadingManager.hide();
                                        setTimeout(() => {
                                            showMainApp(user, newUserData);
                                        }, 300);
                                    }, 800);
                                }
                            } else {
                                // No user logged in
                                // Final step: Ready (100%)
                                await loadingManager.animateProgress(100);
                                await loadingManager.completeStep(4);
                                
                                // Hide loading screen after delay
                                setTimeout(() => {
                                    loadingManager.hide();
                                    setTimeout(() => {
                                        showLoginScreen();
                                    }, 300);
                                }, 800);
                            }
                            resolve();
                        } catch (error) {
                            console.error("Error in auth state change:", error);
                            reject(error);
                        }
                    }, (error) => {
                        clearTimeout(authTimeout);
                        console.error('Auth state change error:', error);
                        // Continue anyway to show login screen
                        resolve();
                    });
                });
                
            } catch (error) {
                console.error('Initialization error:', error);
                
                // Still show login screen even if Firebase fails
                await loadingManager.animateProgress(100);
                await loadingManager.completeStep(4);
                
                // Hide loading screen after delay
                setTimeout(() => {
                    loadingManager.hide();
                    setTimeout(() => {
                        // Try to show login screen
                        try {
                            showLoginScreen();
                            // Show error modal if Firebase completely failed
                            if (error.message && error.message.includes('Firebase')) {
                                setTimeout(() => {
                                    showModal(errorModal, 'Connection issue. You can still use offline features.');
                                }, 1000);
                            }
                        } catch (e) {
                            // Last resort - show simple message
                            document.body.innerHTML = `
                                <div style="padding: 40px; text-align: center; color: white;">
                                    <h1>Earn For Earn</h1>
                                    <p>Loading error. Please refresh the page.</p>
                                    <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: purple; color: white; border: none; border-radius: 10px;">
                                        Refresh Page
                                    </button>
                                </div>
                            `;
                        }
                    }, 300);
                }, 800);
            }
        }
        
        // Show login screen
        function showLoginScreen() {
            try {
                loginScreen.style.display = 'flex';
                signupScreen.style.display = 'none';
                mainApp.style.display = 'none';
                
                // Clear form fields
                loginEmail.value = '';
                loginPassword.value = '';
            } catch (error) {
                console.error("Error showing login screen:", error);
            }
        }
        
        // Show signup screen
        function showSignupScreen() {
            try {
                loginScreen.style.display = 'none';
                signupScreen.style.display = 'flex';
                mainApp.style.display = 'none';
                
                // Clear form fields
                signupEmail.value = '';
                signupPassword.value = '';
                signupConfirmPassword.value = '';
                signupReferral.value = '';
            } catch (error) {
                console.error("Error showing signup screen:", error);
            }
        }
        
        // Show main app
        function showMainApp(user, userData) {
            try {
                loginScreen.style.display = 'none';
                signupScreen.style.display = 'none';
                mainApp.style.display = 'block';
                
                // Update user info
                updateUserInfo(userData);
                
                // Initialize navigation
                initNavigation();
                
                // Load tasks
                loadTasks();
                
                // Start reset timer
                startResetTimer();
                
                // Update payment schedule
                updatePaymentSchedule(userData);
                
                // Check withdrawal requirements
                checkWithdrawalRequirements(userData);
            } catch (error) {
                console.error("Error showing main app:", error);
                showLoginScreen();
            }
        }
        
        // Update user info in the app
        function updateUserInfo(userData) {
            if (!userData) return;
            
            try {
                // Set user initial
                const initial = userData.email.charAt(0).toUpperCase();
                userInitial.textContent = initial;
                
                // Set menu info
                menuUserEmail.textContent = userData.email;
                menuReferralCode.textContent = userData.referralCode || 'N/A';
                
                // Update balance and stats
                balanceAmount.textContent = `${(userData.balance || 0).toLocaleString()}`;
                referralsCount.textContent = (userData.referrals || []).length;
                totalEarned.textContent = `${(userData.totalEarned || 0).toLocaleString()}`;
                referralBonus.textContent = `${(userData.referralBonus || 0).toLocaleString()}`;
                withdrawBalance.textContent = `${(userData.balance || 0).toLocaleString()}`;
                
                // Update referral code
                referralCode.textContent = userData.referralCode || 'N/A';
                
                // Update referrals count
                const refCount = (userData.referrals || []).length;
                totalReferrals.textContent = `${refCount} ${refCount === 1 ? 'referral' : 'referrals'}`;
                totalReferralsCount.textContent = refCount;
                
                // Calculate total referral earnings
                const totalRefEarnings = (userData.referrals || []).reduce((sum, ref) => sum + (ref.bonus || 0), 0);
                totalReferralEarnings.textContent = totalRefEarnings.toLocaleString();
                
                // Update referrals list
                updateReferralsList(userData);
                
                // Update withdrawal amount field
                const balance = userData.balance || 0;
                withdrawAmount.value = balance >= 1000000 ? balance : 1000000;
                withdrawAmount.max = balance;
                
                // Update payment schedule
                updatePaymentSchedule(userData);
                
                // Check withdrawal requirements
                checkWithdrawalRequirements(userData);
            } catch (error) {
                console.error("Error updating user info:", error);
            }
        }
        
        // Update referrals list
        function updateReferralsList(userData) {
            const referrals = userData.referrals || [];
            
            try {
                if (referrals.length > 0) {
                    zeroReferrals.style.display = 'none';
                    referralsList.style.display = 'block';
                    
                    // Clear and rebuild list
                    referralsList.innerHTML = '';
                    
                    referrals.forEach((ref, index) => {
                        const referralItem = document.createElement('div');
                        referralItem.className = 'friend-item';
                        referralItem.innerHTML = `
                            <div class="friend-info">
                                <div class="friend-avatar">${(ref.email || '').charAt(0).toUpperCase()}</div>
                                <div class="friend-details">
                                    <h4>${ref.email || 'Unknown'}</h4>
                                    <div class="friend-date">${new Date(ref.date || Date.now()).toLocaleDateString()}</div>
                                </div>
                            </div>
                            <div class="friend-earned">+${(ref.bonus || 0).toLocaleString()}</div>
                        `;
                        referralsList.appendChild(referralItem);
                    });
                } else {
                    zeroReferrals.style.display = 'block';
                    referralsList.style.display = 'none';
                }
            } catch (error) {
                console.error("Error updating referrals list:", error);
            }
        }
        
        // Start reset timer
        function startResetTimer() {
            function updateTimer() {
                try {
                    const timeUntilReset = userManager.getTimeUntilReset();
                    const hours = Math.floor((timeUntilReset % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeUntilReset % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeUntilReset % (1000 * 60)) / 1000);
                    
                    resetTime.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                } catch (error) {
                    console.error("Error updating timer:", error);
                }
            }
            
            updateTimer();
            setInterval(updateTimer, 1000);
        }
        
        // Load tasks into the task section
        function loadTasks() {
            try {
                tasksContainer.innerHTML = '';
                
                tasks.forEach(task => {
                    const taskCard = document.createElement('div');
                    taskCard.className = 'task-card';
                    taskCard.id = `task-${task.id}`;
                    
                    // Determine reward class
                    let rewardClass = '';
                    if (task.isPepe) {
                        rewardClass = 'pepe';
                    }
                    
                    // Determine button class
                    let buttonClass = '';
                    if (task.isPepe) {
                        buttonClass = 'pepe';
                    }
                    
                    // Format description with better instructions for task 4
                    let description = task.description;
                    if (task.id === 'task4') {
                        description = `
                            <div style="margin-bottom: 10px;">${task.description}</div>
                            <div style="background: rgba(138, 43, 226, 0.1); padding: 10px; border-radius: 8px; border-left: 3px solid var(--purple); font-size: 0.85rem;">
                                <i class="fas fa-info-circle"></i> 
                                <strong>Important:</strong> Stay on the opened page for 12 seconds. Don't switch tabs!
                            </div>
                        `;
                    }
                    
                    taskCard.innerHTML = `
                        <div class="task-header">
                            <div class="task-title">${task.title}</div>
                            <div class="task-reward ${rewardClass}">${task.reward.toLocaleString()}</div>
                        </div>
                        <div class="task-description">${description}</div>
                        <button class="task-button ${buttonClass}" id="start-task-${task.id}">
                            <i class="fas fa-play-circle"></i> Start Task
                        </button>
                        <div class="task-status pending" id="task-status-${task.id}" style="display: none;">
                            <i class="fas fa-clock"></i> Ready to complete
                        </div>
                        <div class="task-progress" id="task-progress-${task.id}">
                            Today: 0/${task.dailyLimit}
                        </div>
                    `;
                    
                    tasksContainer.appendChild(taskCard);
                    
                    // Add event listener to task button
                    const taskButton = document.getElementById(`start-task-${task.id}`);
                    taskButton.addEventListener('click', () => startTask(task));
                });
                
                // Update task statuses
                updateTaskStatuses();
            } catch (error) {
                console.error("Error loading tasks:", error);
            }
        }
        
        // Update task statuses based on cooldown and daily limit
        function updateTaskStatuses() {
            const user = userManager.currentUser;
            if (!user) return;
            
            try {
                const today = new Date().toDateString();
                const dailyTotalCount = userManager.getDailyTotalCount(user.uid, today);
                const totalAttemptsLeft = 500 - dailyTotalCount;
                
                // Update task limit info
                taskLimitInfo.textContent = `${totalAttemptsLeft} attempts left`;
                
                tasks.forEach(task => {
                    const statusElement = document.getElementById(`task-status-${task.id}`);
                    const buttonElement = document.getElementById(`start-task-${task.id}`);
                    const progressElement = document.getElementById(`task-progress-${task.id}`);
                    
                    // Get task-specific daily count
                    const taskDailyCount = userManager.getTaskDailyCount(user.uid, task.id);
                    
                    // Update progress
                    progressElement.textContent = `Today: ${taskDailyCount}/${task.dailyLimit}`;
                    
                    const canComplete = userManager.canCompleteTask(user.uid, task.id);
                    
                    if (canComplete.reason === 'total_daily_limit') {
                        // Total daily limit reached (500)
                        statusElement.style.display = 'block';
                        statusElement.className = 'task-status limited';
                        statusElement.innerHTML = `<i class="fas fa-ban"></i> Daily total limit reached (500/500)`;
                        buttonElement.disabled = true;
                        buttonElement.innerHTML = '<i class="fas fa-ban"></i> Daily Limit Reached';
                    } else if (canComplete.reason === 'task_daily_limit') {
                        // Individual task daily limit reached (125)
                        statusElement.style.display = 'block';
                        statusElement.className = 'task-status limited';
                        statusElement.innerHTML = `<i class="fas fa-ban"></i> Task daily limit reached (125/125)`;
                        buttonElement.disabled = true;
                        buttonElement.innerHTML = '<i class="fas fa-ban"></i> Task Limit Reached';
                    } else if (canComplete.reason === 'cooldown') {
                        // Cooldown active (1 MINUTE)
                        statusElement.style.display = 'block';
                        statusElement.className = 'task-status countdown';
                        statusElement.innerHTML = `<i class="fas fa-clock"></i> Available in ${canComplete.timeRemaining} seconds`;
                        buttonElement.disabled = true;
                        buttonElement.innerHTML = '<i class="fas fa-clock"></i> On Cooldown';
                    } else {
                        // Task can be completed
                        statusElement.style.display = 'none';
                        buttonElement.disabled = false;
                        buttonElement.innerHTML = '<i class="fas fa-play-circle"></i> Start Task';
                    }
                });
            } catch (error) {
                console.error("Error updating task statuses:", error);
            }
        }
        
        // Start a task
        async function startTask(task) {
            const user = userManager.currentUser;
            if (!user) return;
            
            try {
                // Check if task can be completed
                const canComplete = userManager.canCompleteTask(user.uid, task.id);
                
                if (canComplete.reason === 'total_daily_limit') {
                    showModal(errorModal, 'Total daily limit reached! You can complete only 500 tasks per day. Try again tomorrow.');
                    return;
                }
                
                if (canComplete.reason === 'task_daily_limit') {
                    showModal(errorModal, `Task daily limit reached! You can complete this task only 125 times per day. Try again tomorrow.`);
                    return;
                }
                
                if (canComplete.reason === 'cooldown') {
                    showModal(errorModal, `Please wait ${canComplete.timeRemaining} seconds before starting this task again.`);
                    return;
                }
                
                // Special handling for task 2 (in-app interstitial)
                if (task.id === 'task2') {
                    // For task 2, we'll trigger the in-app ad manually
                    if (typeof show_10541383 !== 'undefined') {
                        try {
                            // Configure in-app interstitial ad
                            show_10541383({
                                type: 'inApp',
                                inAppSettings: {
                                    frequency: 2,
                                    capping: 0.1, // 0.1 hours = 6 minutes
                                    interval: 30, // 30 seconds interval
                                    timeout: 5, // 5 seconds delay
                                    everyPage: false
                                }
                            }).then(async () => {
                                // Ad was shown successfully
                                
                                // Complete the task and give reward
                                await userManager.completeTask(user.uid, task.id, task.reward);
                                
                                // Update UI
                                updateUserInfo(userManager.userData);
                                updateTaskStatuses();
                                
                                // Show success message
                                showModal(successModal, 'You have watched an in-app interstitial ad! 100 has been added to your balance.');
                            }).catch(error => {
                                // Ad failed to load
                                showModal(errorModal, 'Failed to load in-app ad. Please try again.');
                            });
                        } catch (error) {
                            showModal(errorModal, 'Error showing in-app ad. Please try again.');
                        }
                    } else {
                        showModal(errorModal, 'Ad system not available. Please try again later.');
                    }
                    return;
                }
                
                // Disable the button immediately
                const buttonElement = document.getElementById(`start-task-${task.id}`);
                buttonElement.disabled = true;
                buttonElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
                
                // Check if this is a rewarded ad task
                if (task.type === 'rewardedAd') {
                    // Show rewarded interstitial ad
                    if (typeof show_10541383 !== 'undefined') {
                        show_10541383().then(async () => {
                            // User watched the ad completely
                            await userManager.completeTask(user.uid, task.id, task.reward);
                            
                            // Update UI
                            updateUserInfo(userManager.userData);
                            updateTaskStatuses();
                            
                            // Show success message
                            showModal(successModal, 'You have watched an ad! 100 has been added to your balance.');
                        }).catch(error => {
                            // Ad failed to load or user didn't watch
                            buttonElement.disabled = false;
                            buttonElement.innerHTML = '<i class="fas fa-play-circle"></i> Start Task';
                            
                            showModal(errorModal, 'Failed to load ad or ad was not completed. Please try again.');
                        });
                    } else {
                        // SDK not loaded, use fallback
                        buttonElement.innerHTML = '<i class="fas fa-external-link-alt"></i> Starting...';
                        setTimeout(async () => {
                            await userManager.completeTask(user.uid, task.id, task.reward);
                            updateUserInfo(userManager.userData);
                            updateTaskStatuses();
                            showModal(successModal, 'Task completed! 100 has been added to your balance.');
                        }, 1000);
                    }
                } 
                // For Task 3: Rewarded popup ad with 12 second warning
                else if (task.id === 'task3') {
                    currentTask = task;
                    taskButtonElement = buttonElement;
                    taskSecondsRemaining = 12;
                    warningTimerDisplay.textContent = taskSecondsRemaining;
                    
                    // Update modal instructions
                    const instructions = document.getElementById('task4Instructions');
                    if (instructions) {
                        instructions.innerHTML = `
                            <h4 style="margin-bottom: 10px; color: white;">How to complete this task:</h4>
                            <div class="instruction-step">
                                <i class="fas fa-mouse-pointer"></i>
                                <span>Watch the popup ad for <strong>12 seconds</strong></span>
                            </div>
                            <div class="instruction-step">
                                <i class="fas fa-clock"></i>
                                <span>Don't close the ad until timer completes</span>
                            </div>
                            <div class="instruction-step">
                                <i class="fas fa-check-circle"></i>
                                <span>You will automatically receive <strong>100</strong></span>
                            </div>
                        `;
                    }
                    
                    showModal(timerWarningModal);
                }
                // For Task 4: Link-based tasks with 12 second warning
                else if (task.id === 'task4') {
                    currentTask = task;
                    taskButtonElement = buttonElement;
                    taskSecondsRemaining = 12;
                    warningTimerDisplay.textContent = taskSecondsRemaining;
                    
                    // Update modal instructions
                    const instructions = document.getElementById('task4Instructions');
                    if (instructions) {
                        instructions.innerHTML = `
                            <h4 style="margin-bottom: 10px; color: white;">How to complete this task:</h4>
                            <div class="instruction-step">
                                <i class="fas fa-mouse-pointer"></i>
                                <span>Click "Start Task" to open a new tab</span>
                            </div>
                            <div class="instruction-step">
                                <i class="fas fa-clock"></i>
                                <span>Stay on the opened page for <strong>12 seconds</strong></span>
                            </div>
                            <div class="instruction-step">
                                <i class="fas fa-check-circle"></i>
                                <span>You will automatically return and receive <strong>100</strong></span>
                            </div>
                        `;
                    }
                    
                    showModal(timerWarningModal);
                }
            } catch (error) {
                console.error("Error starting task:", error);
                showModal(errorModal, 'Error starting task. Please try again.');
            }
        }
        
        // Start the 12-second task timer for Task 3 (popup ad) or Task 4 (link-based)
        async function startTaskTimer() {
            const user = userManager.currentUser;
            if (!user || !currentTask || !taskButtonElement) return;
            
            try {
                // For Task 3: Show rewarded popup ad
                if (currentTask.id === 'task3') {
                    // Update button text
                    taskButtonElement.innerHTML = '<i class="fas fa-clock"></i> 12 seconds remaining...';
                    
                    // Start timer
                    taskStartedTime = Date.now();
                    taskCompleted = false;
                    
                    // Show rewarded popup ad
                    if (typeof show_10541383 !== 'undefined') {
                        show_10541383('pop').then(async () => {
                            // User watched the ad completely
                            // Start checking for 12 seconds
                            taskTimerInterval = setInterval(async () => {
                                // Calculate time elapsed
                                const timeElapsed = Date.now() - taskStartedTime;
                                
                                if (timeElapsed >= 12000) { // 12 seconds
                                    // 12 seconds completed successfully
                                    clearInterval(taskTimerInterval);
                                    taskCompleted = true;
                                    
                                    // Give reward
                                    await userManager.completeTask(user.uid, currentTask.id, currentTask.reward);
                                    
                                    // Update UI
                                    updateUserInfo(userManager.userData);
                                    updateTaskStatuses();
                                    
                                    // Show success message
                                    showModal(successModal, 'Task completed successfully! You stayed for 12 seconds. 100 has been added to your balance.');
                                    
                                    // Reset variables
                                    currentTask = null;
                                    taskButtonElement = null;
                                } else {
                                    // Update button text with remaining time
                                    const remainingSeconds = Math.ceil((12000 - timeElapsed) / 1000);
                                    taskButtonElement.innerHTML = `<i class="fas fa-clock"></i> ${remainingSeconds} seconds remaining...`;
                                }
                            }, 1000);
                        }).catch(error => {
                            // Ad failed to load or user didn't watch
                            taskButtonElement.disabled = false;
                            taskButtonElement.innerHTML = '<i class="fas fa-play-circle"></i> Start Task';
                            showModal(errorModal, 'Failed to load ad or ad was not completed. Please try again.');
                            currentTask = null;
                            taskButtonElement = null;
                        });
                    } else {
                        // SDK not loaded, use fallback
                        taskButtonElement.innerHTML = '<i class="fas fa-external-link-alt"></i> Starting...';
                        
                        // Start timer for fallback
                        taskTimerInterval = setInterval(async () => {
                            const timeElapsed = Date.now() - taskStartedTime;
                            
                            if (timeElapsed >= 12000) { // 12 seconds
                                clearInterval(taskTimerInterval);
                                taskCompleted = true;
                                
                                // Give reward
                                await userManager.completeTask(user.uid, currentTask.id, currentTask.reward);
                                
                                // Update UI
                                updateUserInfo(userManager.userData);
                                updateTaskStatuses();
                                
                                // Show success message
                                showModal(successModal, 'Task completed! 100 has been added to your balance.');
                                
                                // Reset variables
                                currentTask = null;
                                taskButtonElement = null;
                            } else {
                                const remainingSeconds = Math.ceil((12000 - timeElapsed) / 1000);
                                taskButtonElement.innerHTML = `<i class="fas fa-clock"></i> ${remainingSeconds} seconds remaining...`;
                            }
                        }, 1000);
                    }
                } 
                // For Task 4: Open link in new tab with IMPROVED timer
                else if (currentTask.id === 'task4') {
                    // Open task link in new tab
                    taskTab = window.open(currentTask.link, '_blank');
                    
                    if (!taskTab) {
                        showModal(errorModal, 'Please allow pop-ups to start the task.');
                        taskButtonElement.disabled = false;
                        taskButtonElement.innerHTML = '<i class="fas fa-play-circle"></i> Start Task';
                        currentTask = null;
                        taskButtonElement = null;
                        return;
                    }
                    
                    // Update button text
                    taskButtonElement.innerHTML = '<i class="fas fa-clock"></i> 12 seconds remaining...';
                    
                    // Show timer overlay
                    showTaskTimerOverlay();
                    
                    // Start timer with improved accuracy
                    taskStartedTime = Date.now();
                    taskCompleted = false;
                    isTaskTimerRunning = true;
                    
                    // Start the main timer
                    taskTimerInterval = setInterval(async () => {
                        if (!isTaskTimerRunning) return;
                        
                        // Calculate time elapsed
                        const timeElapsed = Date.now() - taskStartedTime;
                        
                        // Update overlay timer
                        updateTaskTimerOverlay(timeElapsed);
                        
                        if (timeElapsed >= 12000) { // 12 seconds
                            // 12 seconds completed successfully
                            clearInterval(taskTimerInterval);
                            taskCompleted = true;
                            isTaskTimerRunning = false;
                            
                            // Close the tab
                            try {
                                if (taskTab && !taskTab.closed) {
                                    taskTab.close();
                                }
                            } catch (e) {
                                // Tab might be protected from closing
                            }
                            
                            // Hide timer overlay
                            hideTaskTimerOverlay();
                            
                            // Give reward
                            await userManager.completeTask(user.uid, currentTask.id, currentTask.reward);
                            
                            // Update UI
                            updateUserInfo(userManager.userData);
                            updateTaskStatuses();
                            
                            // Show success message
                            showModal(successModal, 'Task completed successfully! You stayed for 12 seconds. 100 has been added to your balance.');
                            
                            // Reset button
                            if (taskButtonElement) {
                                taskButtonElement.disabled = false;
                                taskButtonElement.innerHTML = '<i class="fas fa-play-circle"></i> Start Task';
                            }
                            
                            // Reset variables
                            currentTask = null;
                            taskButtonElement = null;
                            taskTab = null;
                        } else {
                            // Update button text with remaining time
                            const remainingSeconds = Math.ceil((12000 - timeElapsed) / 1000);
                            if (taskButtonElement) {
                                taskButtonElement.innerHTML = `<i class="fas fa-clock"></i> ${remainingSeconds} seconds remaining...`;
                            }
                        }
                    }, 100);
                    
                    // Check if tab was closed (improved checking)
                    taskTabCheckInterval = setInterval(() => {
                        if (taskCompleted || !isTaskTimerRunning) {
                            clearInterval(taskTabCheckInterval);
                            return;
                        }
                        
                        try {
                            if (taskTab.closed) {
                                // Tab was closed before 12 seconds
                                clearInterval(taskTabCheckInterval);
                                clearInterval(taskTimerInterval);
                                isTaskTimerRunning = false;
                                
                                hideTaskTimerOverlay();
                                
                                if (!taskCompleted) {
                                    if (taskButtonElement) {
                                        taskButtonElement.disabled = false;
                                        taskButtonElement.innerHTML = '<i class="fas fa-play-circle"></i> Start Task';
                                    }
                                    showModal(errorModal, 'You closed the tab before 12 seconds! No reward given. Please try again without closing the tab.');
                                    currentTask = null;
                                    taskButtonElement = null;
                                    taskTab = null;
                                }
                            }
                        } catch (e) {
                            // Tab might be in a different origin, we can't check
                            // We'll rely on the focus detection instead
                        }
                    }, 500);
                    
                    // Detect when user returns to our tab early (with grace period)
                    let lastFocusTime = Date.now();
                    let hasWarned = false;
                    
                    window.addEventListener('focus', () => {
                        if (!isTaskTimerRunning || taskCompleted) return;
                        
                        const now = Date.now();
                        const timeElapsed = now - taskStartedTime;
                        
                        // Only show error if user returns BEFORE 10 seconds (2 seconds grace period)
                        if (timeElapsed < 10000 && !hasWarned) {
                            hasWarned = true;
                            
                            // User returned too early
                            clearInterval(taskTimerInterval);
                            clearInterval(taskTabCheckInterval);
                            isTaskTimerRunning = false;
                            
                            hideTaskTimerOverlay();
                            
                            // Try to close tab
                            try {
                                if (taskTab && !taskTab.closed) {
                                    taskTab.close();
                                }
                            } catch (e) {
                                // Tab might be protected
                            }
                            
                            if (taskButtonElement) {
                                taskButtonElement.disabled = false;
                                taskButtonElement.innerHTML = '<i class="fas fa-play-circle"></i> Start Task';
                            }
                            
                            showModal(errorModal, 
                                `<div style="text-align: center;">
                                    <i class="fas fa-exclamation-triangle" style="font-size: 2rem; color: #ff6b6b; margin-bottom: 10px;"></i>
                                    <h3>Task Not Completed</h3>
                                    <p>You returned before completing the 12 seconds!</p>
                                    <p style="margin-top: 10px; font-size: 0.9rem; color: #cccccc;">
                                        <strong>Tip:</strong> Don't switch tabs until the timer completes.
                                    </p>
                                </div>`
                            );
                            
                            currentTask = null;
                            taskButtonElement = null;
                            taskTab = null;
                        }
                    });
                }
            } catch (error) {
                console.error("Error in task timer:", error);
                showModal(errorModal, 'Error completing task. Please try again.');
                if (taskButtonElement) {
                    taskButtonElement.disabled = false;
                    taskButtonElement.innerHTML = '<i class="fas fa-play-circle"></i> Start Task';
                }
                currentTask = null;
                taskButtonElement = null;
                hideTaskTimerOverlay();
            }
        }
        
        // Show task timer overlay
        function showTaskTimerOverlay() {
            taskTimerOverlay.classList.add('active');
            taskTimerCount.textContent = '12';
            remainingSeconds.textContent = '12';
            taskTimerProgressFill.style.width = '0%';
            taskTimerMessage.textContent = 'Stay on the opened page. Don\'t switch tabs!';
        }
        
        // Update task timer overlay
        function updateTaskTimerOverlay(timeElapsed) {
            const remaining = Math.max(0, 12000 - timeElapsed);
            const seconds = Math.ceil(remaining / 1000);
            const progress = ((12000 - remaining) / 12000) * 100;
            
            taskTimerCount.textContent = seconds;
            remainingSeconds.textContent = seconds;
            taskTimerProgressFill.style.width = `${progress}%`;
            
            if (seconds <= 5) {
                taskTimerCount.style.color = 'var(--warning)';
                taskTimerMessage.textContent = 'Almost done! Don\'t switch tabs now!';
            } else {
                taskTimerCount.style.color = 'var(--purple)';
            }
        }
        
        // Hide task timer overlay
        function hideTaskTimerOverlay() {
            taskTimerOverlay.classList.remove('active');
        }
        
        // Check withdrawal requirements
        function checkWithdrawalRequirements(userData) {
            if (!userData) return false;
            
            try {
                let allRequirementsMet = true;
                
                // Requirement 1: Minimum balance 1,000,000
                if (userData.balance >= 1000000) {
                    req1Status.textContent = 'Met';
                    req1Status.className = 'requirement-status completed';
                    req1Icon.innerHTML = '<i class="fas fa-check"></i>';
                    req1Icon.className = 'requirement-icon completed';
                } else {
                    req1Status.textContent = `Need ${(1000000 - userData.balance).toLocaleString()} more`;
                    req1Status.className = 'requirement-status';
                    req1Icon.innerHTML = '<i class="fas fa-coins"></i>';
                    req1Icon.className = 'requirement-icon pending';
                    allRequirementsMet = false;
                }
                
                // Requirement 2: Minimum 3 referrals
                if ((userData.referrals || []).length >= 3) {
                    req2Status.textContent = 'Met';
                    req2Status.className = 'requirement-status completed';
                    req2Icon.innerHTML = '<i class="fas fa-check"></i>';
                    req2Icon.className = 'requirement-icon completed';
                } else {
                    req2Status.textContent = `Need ${3 - (userData.referrals || []).length} more referrals`;
                    req2Status.className = 'requirement-status';
                    req2Icon.innerHTML = '<i class="fas fa-user-friends"></i>';
                    req2Icon.className = 'requirement-icon pending';
                    allRequirementsMet = false;
                }
                
                // Requirement 3: Within monthly payment window (3rd-9th)
                const isWithinWindow = userManager.isWithinPaymentWindow();
                if (isWithinWindow) {
                    req3Status.textContent = 'Available (3rd-9th)';
                    req3Status.className = 'requirement-status completed';
                    req3Icon.innerHTML = '<i class="fas fa-check"></i>';
                    req3Icon.className = 'requirement-icon completed';
                } else {
                    req3Status.textContent = 'Wait for payment window (3rd-9th)';
                    req3Status.className = 'requirement-status';
                    req3Icon.innerHTML = '<i class="fas fa-calendar-alt"></i>';
                    req3Icon.className = 'requirement-icon pending';
                    allRequirementsMet = false;
                }
                
                // Requirement 4: No withdrawal this month
                const hasWithdrawn = userManager.hasWithdrawnThisMonth(userData);
                if (!hasWithdrawn) {
                    req4Status.textContent = 'Not withdrawn this month';
                    req4Status.className = 'requirement-status completed';
                    req4Icon.innerHTML = '<i class="fas fa-check"></i>';
                    req4Icon.className = 'requirement-icon completed';
                } else {
                    req4Status.textContent = 'Already withdrawn this month';
                    req4Status.className = 'requirement-status';
                    req4Icon.innerHTML = '<i class="fas fa-ban"></i>';
                    req4Icon.className = 'requirement-icon pending';
                    allRequirementsMet = false;
                }
                
                // Show/hide next button based on requirements
                if (allRequirementsMet) {
                    nextButton.disabled = false;
                    nextButton.classList.add('active');
                } else {
                    nextButton.disabled = true;
                    nextButton.classList.remove('active');
                }
                
                return allRequirementsMet;
            } catch (error) {
                console.error("Error checking withdrawal requirements:", error);
                return false;
            }
        }
        
        // Initialize navigation system
        function initNavigation() {
            try {
                // Get all navigation buttons
                const navButtons = document.querySelectorAll('.nav-btn');
                const contentSections = document.querySelectorAll('.content-section');
                
                // Function to switch between sections
                function switchSection(targetId) {
                    // Hide all sections
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // Show target section
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.classList.add('active');
                    }
                    
                    // Update active button
                    navButtons.forEach(button => {
                        button.classList.remove('active');
                    });
                    
                    // Find and activate the clicked button
                    const activeButton = document.querySelector(`.nav-btn[data-target="${targetId}"]`);
                    if (activeButton) {
                        activeButton.classList.add('active');
                    }
                    
                    // Hide binance form and success message when switching away from withdraw section
                    if (targetId !== 'withdraw-section') {
                        binanceForm.classList.remove('active');
                        successMessage.classList.remove('active');
                        nextButton.classList.remove('active');
                    } else {
                        // When switching to withdraw section, check requirements
                        const userData = userManager.userData;
                        if (userData) {
                            checkWithdrawalRequirements(userData);
                            updatePaymentSchedule(userData);
                        }
                    }
                    
                    // Update task statuses when switching to task section
                    if (targetId === 'task-section') {
                        updateTaskStatuses();
                    }
                }
                
                // Add click event to all navigation buttons
                navButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const targetId = this.getAttribute('data-target');
                        switchSection(targetId);
                    });
                });
                
                // Initialize with Home section active
                switchSection('home-section');
            } catch (error) {
                console.error("Error initializing navigation:", error);
            }
        }
        
        // Show modal
        function showModal(modal, message = '') {
            try {
                if (message) {
                    const messageElement = modal.querySelector('.modal-message');
                    if (messageElement) {
                        if (typeof message === 'string' && message.includes('<')) {
                            messageElement.innerHTML = message;
                        } else {
                            messageElement.textContent = message;
                        }
                    }
                }
                modal.classList.add('active');
            } catch (error) {
                console.error("Error showing modal:", error);
            }
        }
        
        // Hide modal
        function hideModal(modal) {
            try {
                modal.classList.remove('active');
            } catch (error) {
                console.error("Error hiding modal:", error);
            }
        }
        
        // Initialize the app
        function initApp() {
            try {
                // Start app initialization with loading screen
                initializeApp();
                
                // Event Listeners
                if (goToSignup) goToSignup.addEventListener('click', showSignupScreen);
                if (goToLogin) goToLogin.addEventListener('click', showLoginScreen);
                
                // Login form submission
                if (loginForm) {
                    loginForm.addEventListener('submit', async function(e) {
                        e.preventDefault();
                        
                        const email = loginEmail.value.trim();
                        const password = loginPassword.value;
                        
                        if (!email || !password) {
                            showModal(errorModal, 'Please fill in all fields');
                            return;
                        }
                        
                        showLoading('Logging in...');
                        
                        const result = await userManager.loginUser(email, password);
                        
                        hideLoading();
                        
                        if (result.success) {
                            showMainApp(result.user, result.userData);
                        } else {
                            showModal(errorModal, result.message);
                        }
                    });
                }
                
                // Signup form submission
                if (signupForm) {
                    signupForm.addEventListener('submit', async function(e) {
                        e.preventDefault();
                        
                        const email = signupEmail.value.trim();
                        const password = signupPassword.value;
                        const confirmPassword = signupConfirmPassword.value;
                        const referral = signupReferral.value.trim().toUpperCase();
                        
                        if (!email || !password || !confirmPassword) {
                            showModal(errorModal, 'Please fill in all required fields');
                            return;
                        }
                        
                        if (password !== confirmPassword) {
                            showModal(errorModal, 'Passwords do not match');
                            return;
                        }
                        
                        if (password.length < 6) {
                            showModal(errorModal, 'Password must be at least 6 characters');
                            return;
                        }
                        
                        // Check if referral code is valid if provided
                        if (referral) {
                            showLoading('Checking referral code...');
                            const referrer = await userManager.getUserByReferralCode(referral);
                            hideLoading();
                            
                            if (!referrer) {
                                showModal(errorModal, 'Invalid referral code');
                                return;
                            }
                        }
                        
                        showLoading('Creating account...');
                        
                        const result = await userManager.createUser(email, password, referral || null);
                        
                        hideLoading();
                        
                        if (result.success) {
                            // Show referral bonus modal if applicable
                            if (result.hasReferralBonus) {
                                showModal(referralBonusModal, 'Congratulations! You received 500 referral bonus for signing up with a referral code.');
                            } else {
                                showModal(successModal, 'Account created successfully! Welcome to Earn For Earn.');
                            }
                            
                            // Auto login after signup
                            const loginResult = await userManager.loginUser(email, password);
                            
                            if (loginResult.success) {
                                showMainApp(loginResult.user, loginResult.userData);
                            }
                        } else {
                            showModal(errorModal, result.message);
                        }
                    });
                }
                
                // User profile menu
                if (userProfile) {
                    userProfile.addEventListener('click', function() {
                        userMenu.classList.toggle('active');
                    });
                }
                
                // Close menu when clicking outside
                document.addEventListener('click', function(e) {
                    if (userProfile && !userProfile.contains(e.target) && userMenu && !userMenu.contains(e.target)) {
                        userMenu.classList.remove('active');
                    }
                });
                
                // Change Password button
                if (changePasswordBtn) {
                    changePasswordBtn.addEventListener('click', function() {
                        userMenu.classList.remove('active');
                        showModal(changePasswordModal);
                    });
                }
                
                // Copy referral code
                if (copyReferralBtn) {
                    copyReferralBtn.addEventListener('click', function() {
                        navigator.clipboard.writeText(referralCode.textContent).then(() => {
                            showModal(successModal, 'Referral code copied to clipboard! Share it with your friends.');
                        });
                    });
                }
                
                // Share referral code buttons
                if (shareReferralBtn) {
                    shareReferralBtn.addEventListener('click', function() {
                        navigator.clipboard.writeText(referralCode.textContent).then(() => {
                            showModal(successModal, 'Referral code copied! Share it with your friends.');
                        });
                    });
                }
                
                if (zeroShareReferralBtn) {
                    zeroShareReferralBtn.addEventListener('click', function() {
                        navigator.clipboard.writeText(referralCode.textContent).then(() => {
                            showModal(successModal, 'Referral code copied! Share it with your friends.');
                        });
                    });
                }
                
                // Chat button
                const chatBtn = document.getElementById('earnBtn');
                if (chatBtn) {
                    chatBtn.addEventListener('click', function() {
                        showModal(chatModal);
                    });
                }
                
                // Info section chat button
                if (infoChatBtn) {
                    infoChatBtn.addEventListener('click', function() {
                        // Open Telegram link
                        window.open('https://t.me/earnforearnsuportteam', '_blank');
                    });
                }
                
                // Info section email button
                if (infoEmailBtn) {
                    infoEmailBtn.addEventListener('click', function() {
                        const email = 'earnforearnsuportteam@gmail.com';
                        navigator.clipboard.writeText(email).then(() => {
                            showModal(successModal, 'Support email copied to clipboard!');
                        });
                    });
                }
                
                // Start chat button
                if (startChatBtn) {
                    startChatBtn.addEventListener('click', function() {
                        // Open Telegram link
                        window.open('https://t.me/earnforearnsuportteam', '_blank');
                        hideModal(chatModal);
                    });
                }
                
                // Cancel chat button
                if (cancelChatBtn) {
                    cancelChatBtn.addEventListener('click', function() {
                        hideModal(chatModal);
                    });
                }
                
                // Timer Warning Modal OK button
                if (timerOkBtn) {
                    timerOkBtn.addEventListener('click', function() {
                        hideModal(timerWarningModal);
                        startTaskTimer();
                    });
                }
                
                // Timer Warning Modal Cancel button
                if (timerCancelBtn) {
                    timerCancelBtn.addEventListener('click', function() {
                        hideModal(timerWarningModal);
                        if (taskButtonElement) {
                            taskButtonElement.disabled = false;
                            taskButtonElement.innerHTML = '<i class="fas fa-play-circle"></i> Start Task';
                            currentTask = null;
                            taskButtonElement = null;
                        }
                    });
                }
                
                // Next button (when all requirements met)
                if (nextButton) {
                    nextButton.addEventListener('click', function() {
                        // Show binance form
                        binanceForm.classList.add('active');
                        this.style.display = 'none';
                    });
                }
                
                // Submit withdrawal button
                if (submitWithdrawBtn) {
                    submitWithdrawBtn.addEventListener('click', async function(e) {
                        e.preventDefault();
                        
                        const user = userManager.currentUser;
                        if (!user) return;
                        
                        const email = binanceEmail.value.trim();
                        const amount = parseInt(withdrawAmount.value);
                        const payId = binancePayId.value.trim();
                        
                        if (!email) {
                            showModal(errorModal, 'Please enter your Binance email or UID');
                            return;
                        }
                        
                        if (!amount || amount < 1000000) {
                            showModal(errorModal, 'Minimum withdrawal amount is 1,000,000');
                            return;
                        }
                        
                        if (amount > userManager.userData.balance) {
                            showModal(errorModal, 'Insufficient balance');
                            return;
                        }
                        
                        // Submit withdrawal request
                        const binanceDetails = {
                            email: email,
                            payId: payId,
                            submittedAt: new Date().toISOString()
                        };
                        
                        showLoading('Submitting withdrawal request...');
                        
                        const result = await userManager.submitWithdrawal(user.uid, amount, binanceDetails);
                        
                        hideLoading();
                        
                        if (result.success) {
                            // Hide binance form and show success message
                            binanceForm.classList.remove('active');
                            successMessage.classList.add('active');
                            
                            // Update UI
                            updateUserInfo(userManager.userData);
                            updatePaymentSchedule(userManager.userData);
                            checkWithdrawalRequirements(userManager.userData);
                            
                            // Show success message
                            showModal(successModal, `Withdrawal request submitted! You will receive ${amount.toLocaleString()} to your Binance account between 3rd-9th of next month.`);
                            
                            // Clear form fields
                            binanceEmail.value = '';
                            withdrawAmount.value = '';
                            binancePayId.value = '';
                        } else {
                            showModal(errorModal, result.message);
                        }
                    });
                }
                
                // Change Password form submission
                if (changePasswordForm) {
                    changePasswordForm.addEventListener('submit', async function(e) {
                        e.preventDefault();
                        
                        const user = userManager.currentUser;
                        if (!user) return;
                        
                        const currentPass = currentPassword.value;
                        const newPass = newPassword.value;
                        const confirmPass = confirmNewPassword.value;
                        
                        if (!currentPass || !newPass || !confirmPass) {
                            showModal(errorModal, 'Please fill in all fields');
                            return;
                        }
                        
                        if (newPass !== confirmPass) {
                            showModal(errorModal, 'New passwords do not match');
                            return;
                        }
                        
                        if (newPass.length < 6) {
                            showModal(errorModal, 'New password must be at least 6 characters');
                            return;
                        }
                        
                        showLoading('Changing password...');
                        
                        const result = await userManager.changePassword(user.uid, currentPass, newPass);
                        
                        hideLoading();
                        
                        if (result.success) {
                            hideModal(changePasswordModal);
                            showModal(successModal, 'Password changed successfully!');
                            
                            // Clear form fields
                            currentPassword.value = '';
                            newPassword.value = '';
                            confirmNewPassword.value = '';
                        } else {
                            showModal(errorModal, result.message);
                        }
                    });
                }
                
                // Cancel Change Password
                if (cancelChangePasswordBtn) {
                    cancelChangePasswordBtn.addEventListener('click', function() {
                        hideModal(changePasswordModal);
                        
                        // Clear form fields
                        currentPassword.value = '';
                        newPassword.value = '';
                        confirmNewPassword.value = '';
                    });
                }
                
                // Modal close buttons
                if (successOkBtn) successOkBtn.addEventListener('click', () => hideModal(successModal));
                if (errorOkBtn) errorOkBtn.addEventListener('click', () => hideModal(errorModal));
                if (referralBonusOkBtn) referralBonusOkBtn.addEventListener('click', () => hideModal(referralBonusModal));
                
                // Close modals on background click
                [successModal, errorModal, referralBonusModal, chatModal, timerWarningModal, changePasswordModal].forEach(modal => {
                    if (modal) {
                        modal.addEventListener('click', function(e) {
                            if (e.target === this) {
                                hideModal(this);
                            }
                        });
                    }
                });
                
                // Handle page visibility changes (for Task 4)
                document.addEventListener('visibilitychange', function() {
                    if (currentTask && currentTask.id === 'task4' && isTaskTimerRunning && !taskCompleted) {
                        if (document.hidden) {
                            // Page is hidden (user switched tabs)
                            // We already handle this in the focus event with grace period
                        }
                    }
                });
                
            } catch (error) {
                console.error("Error initializing app:", error);
                // Show simple error message
                document.body.innerHTML = `
                    <div style="padding: 40px; text-align: center; color: white; background: black; min-height: 100vh;">
                        <h1>Earn For Earn</h1>
                        <p>App initialization error. Please refresh the page.</p>
                        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: purple; color: white; border: none; border-radius: 10px; cursor: pointer;">
                            Refresh Page
                        </button>
                    </div>
                `;
            }
        }
        
        // Initialize the app when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>